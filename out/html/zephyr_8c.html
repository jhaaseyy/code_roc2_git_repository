<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Strateole2: zephyr.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Strateole2
   </div>
   <div id="projectbrief">Includes the necessary command to relay and configure GPS data</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">zephyr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>ROC2 Zephyr Interface Module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;libconfig.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;termios.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;sys/ioctl.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;poll.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;dirent.h&gt;</code><br />
<code>#include &quot;<a class="el" href="zephyr_8h_source.html">zephyr.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for zephyr.c:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c__incl.png" border="0" usemap="#zephyr_8c" alt=""/></div>
<map name="zephyr_8c" id="zephyr_8c">
</map>
</div>
</div>
<p><a href="zephyr_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a777ab160b5ad985f2ccc1a878e5936fd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>&#160;&#160;&#160;300000</td></tr>
<tr class="memdesc:a777ab160b5ad985f2ccc1a878e5936fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function.  <a href="#a777ab160b5ad985f2ccc1a878e5936fd">More...</a><br /></td></tr>
<tr class="separator:a777ab160b5ad985f2ccc1a878e5936fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4420395a38828d6be4aae8646268d258"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a4420395a38828d6be4aae8646268d258">MsgHandler</a> (enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a> msgtype, char *msgdata)</td></tr>
<tr class="separator:a4420395a38828d6be4aae8646268d258"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8252c63f3bdc239fbdf6fbd93d40c76"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#ac8252c63f3bdc239fbdf6fbd93d40c76">HandleIM</a> (char *msgdata)</td></tr>
<tr class="separator:ac8252c63f3bdc239fbdf6fbd93d40c76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5b4e6f9b660a68301b5cd686040e61a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#ac5b4e6f9b660a68301b5cd686040e61a">HandleSAck</a> (char *msgdata)</td></tr>
<tr class="separator:ac5b4e6f9b660a68301b5cd686040e61a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81340cc09bb1fbb59c968fa3d3b41064"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a81340cc09bb1fbb59c968fa3d3b41064">HandleSW</a> (char *msgdata)</td></tr>
<tr class="separator:a81340cc09bb1fbb59c968fa3d3b41064"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a405decabf57ea3d65a9fea453e4a2fa3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a405decabf57ea3d65a9fea453e4a2fa3">HandleTMAck</a> (char *msgdata)</td></tr>
<tr class="separator:a405decabf57ea3d65a9fea453e4a2fa3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24fd4d56749147dbdfbb5817276010a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a24fd4d56749147dbdfbb5817276010a8">HandleTC</a> (char *msgdata)</td></tr>
<tr class="separator:a24fd4d56749147dbdfbb5817276010a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f9ac83f838130b9d2723d02ae37562e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a6f9ac83f838130b9d2723d02ae37562e">HandleGPS</a> (char *msgdata)</td></tr>
<tr class="separator:a6f9ac83f838130b9d2723d02ae37562e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26a5cd9326852a6f3a89225c8642479b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a26a5cd9326852a6f3a89225c8642479b">ZephyrInit</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a26a5cd9326852a6f3a89225c8642479b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs module initialization.  <a href="#a26a5cd9326852a6f3a89225c8642479b">More...</a><br /></td></tr>
<tr class="separator:a26a5cd9326852a6f3a89225c8642479b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40809263d9e34d3d93cdb0eed73db857"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a40809263d9e34d3d93cdb0eed73db857">ZephyrCleanup</a> (void)</td></tr>
<tr class="memdesc:a40809263d9e34d3d93cdb0eed73db857"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes sockets and frees memory.  <a href="#a40809263d9e34d3d93cdb0eed73db857">More...</a><br /></td></tr>
<tr class="separator:a40809263d9e34d3d93cdb0eed73db857"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dbf303fd2c465b1e724a247623fdbd2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a5dbf303fd2c465b1e724a247623fdbd2">CmdLineHandler</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a5dbf303fd2c465b1e724a247623fdbd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses command line arguments.  <a href="#a5dbf303fd2c465b1e724a247623fdbd2">More...</a><br /></td></tr>
<tr class="separator:a5dbf303fd2c465b1e724a247623fdbd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40185ea52d16cecaafae70740e90af29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a40185ea52d16cecaafae70740e90af29">Usage</a> (void)</td></tr>
<tr class="memdesc:a40185ea52d16cecaafae70740e90af29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the usage summary showing valid command line options.  <a href="#a40185ea52d16cecaafae70740e90af29">More...</a><br /></td></tr>
<tr class="separator:a40185ea52d16cecaafae70740e90af29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed0e63e6cf78544f92b023037e3e7b8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a8ed0e63e6cf78544f92b023037e3e7b8">LoadConfigFileSettings</a> (config_t *cfg, const char *path)</td></tr>
<tr class="memdesc:a8ed0e63e6cf78544f92b023037e3e7b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the program configuration file.  <a href="#a8ed0e63e6cf78544f92b023037e3e7b8">More...</a><br /></td></tr>
<tr class="separator:a8ed0e63e6cf78544f92b023037e3e7b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a919ac26442368faff61c89f0f62fd58b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a919ac26442368faff61c89f0f62fd58b">SerialPortInit</a> (<a class="el" href="structserial.html">serial</a> port)</td></tr>
<tr class="separator:a919ac26442368faff61c89f0f62fd58b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af890f66e1e86cf2e43aafd221eddabbd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a> (int baud)</td></tr>
<tr class="separator:af890f66e1e86cf2e43aafd221eddabbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adab6d320323ece6f7627cb9bb04d0eb9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#adab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a> (const char *bits)</td></tr>
<tr class="separator:adab6d320323ece6f7627cb9bb04d0eb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10d59c21de300f9eae88f1b90ef845f2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a10d59c21de300f9eae88f1b90ef845f2">verify_flow</a> (const char *bits)</td></tr>
<tr class="separator:a10d59c21de300f9eae88f1b90ef845f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bacb9e2137b9572d5f02c23de2ad813"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a> (void)</td></tr>
<tr class="separator:a0bacb9e2137b9572d5f02c23de2ad813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29819f4927e98849304e948f13c12574"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a> (void)</td></tr>
<tr class="separator:a29819f4927e98849304e948f13c12574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88fb6383c5c934e876be013729f8ab60"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a88fb6383c5c934e876be013729f8ab60">TodaysDirectoryExists</a> (void)</td></tr>
<tr class="separator:a88fb6383c5c934e876be013729f8ab60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0eaf55c523b081609cd85dd6eb04682b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a> (void)</td></tr>
<tr class="separator:a0eaf55c523b081609cd85dd6eb04682b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45786db9b46a6cc20e64bd0a851655bc"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a45786db9b46a6cc20e64bd0a851655bc">LogFileName</a> (char *name)</td></tr>
<tr class="separator:a45786db9b46a6cc20e64bd0a851655bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8b73dc85a9b8da6978eac659ec8531b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#af8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a> (char *name)</td></tr>
<tr class="separator:af8b73dc85a9b8da6978eac659ec8531b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84b0f0a6d9c4b56b743eb5b171f3172c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a84b0f0a6d9c4b56b743eb5b171f3172c">CloseLogFile</a> (void)</td></tr>
<tr class="separator:a84b0f0a6d9c4b56b743eb5b171f3172c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5366f78d45883b7ad5934d6910efa6c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a5366f78d45883b7ad5934d6910efa6c5">NewFile</a> (void)</td></tr>
<tr class="separator:a5366f78d45883b7ad5934d6910efa6c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af31e21e2ff935496c7ce8dc5e52b65c3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#af31e21e2ff935496c7ce8dc5e52b65c3">LogData</a> (FILE *<a class="el" href="zephyr_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>, char *data, int n)</td></tr>
<tr class="separator:af31e21e2ff935496c7ce8dc5e52b65c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab66e64dd30463cea0a06ac33c9cb3522"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a> (void)</td></tr>
<tr class="separator:ab66e64dd30463cea0a06ac33c9cb3522"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a184ae444081beacfe0bd5b712d378b59"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a> (char *name)</td></tr>
<tr class="separator:a184ae444081beacfe0bd5b712d378b59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af672e15ff453fe857ab4ce7de925f34a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a> (char *name)</td></tr>
<tr class="separator:af672e15ff453fe857ab4ce7de925f34a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf9cb423a606dc4f8232d1b3394042d5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a> (char *name)</td></tr>
<tr class="separator:abf9cb423a606dc4f8232d1b3394042d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e021f179fc712de402af1043ca1a9ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a> (enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a> msgtype, char *payload, int payload_size)</td></tr>
<tr class="separator:a6e021f179fc712de402af1043ca1a9ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabe674fb7d630daaebb86607af12308a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#aabe674fb7d630daaebb86607af12308a">CRCComp</a> (char *data, int len)</td></tr>
<tr class="separator:aabe674fb7d630daaebb86607af12308a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a626fb8bdfcd2bed45be4fe9fabb74f48"><td class="memItemLeft" align="right" valign="top">unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a626fb8bdfcd2bed45be4fe9fabb74f48">CRC</a> (unsigned short last, char next)</td></tr>
<tr class="separator:a626fb8bdfcd2bed45be4fe9fabb74f48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7865b0822633a51bd794f1922f39711"><td class="memItemLeft" align="right" valign="top">unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a> (char *data, int len)</td></tr>
<tr class="separator:aa7865b0822633a51bd794f1922f39711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a224d36d32fdd9a46fced3ac36c639169"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a224d36d32fdd9a46fced3ac36c639169">MsgType</a> (char *typestr)</td></tr>
<tr class="separator:a224d36d32fdd9a46fced3ac36c639169"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a093f472d65a4478a2a23fa69ea593ef0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a> (int state)</td></tr>
<tr class="separator:a093f472d65a4478a2a23fa69ea593ef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1aef5309c25647017f7108bc58873f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#af1aef5309c25647017f7108bc58873f7">gps_reset</a> (int state)</td></tr>
<tr class="separator:af1aef5309c25647017f7108bc58873f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a450d4faa9f19206a09ccd2e461eff601"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a450d4faa9f19206a09ccd2e461eff601">gps_power_toggle</a> (int state)</td></tr>
<tr class="separator:a450d4faa9f19206a09ccd2e461eff601"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e696bce041fca9cc1924bcd65cbc503"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a> (int state)</td></tr>
<tr class="separator:a7e696bce041fca9cc1924bcd65cbc503"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94bb341ea8ea68eb26f43e8664513609"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#a94bb341ea8ea68eb26f43e8664513609">led</a> (int state)</td></tr>
<tr class="separator:a94bb341ea8ea68eb26f43e8664513609"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac266e79779ea42b506b577821d4a834d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zephyr_8c.html#ac266e79779ea42b506b577821d4a834d">set_gpio0</a> (int state)</td></tr>
<tr class="separator:ac266e79779ea42b506b577821d4a834d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ROC2 Zephyr Interface Module. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2018 David Jabson, Brainstorm Engineering</dd></dl>
<p>This program is the first version of data collection software for the ROC2 Radio Occultation Instrument. It lacks the full feature set of the final instrument but performs the following:</p>
<ul>
<li>Reads configuration file to determine commands for setting up GPS receiver</li>
<li>Configures GPS receiver</li>
<li>Launch data offload program</li>
<li>Logs data received from GPS receiver to files</li>
<li>When data file is closed, calls data processing script and open new file </li>
</ul>

<p class="definition">Definition in file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a777ab160b5ad985f2ccc1a878e5936fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a777ab160b5ad985f2ccc1a878e5936fd">&#9670;&nbsp;</a></span>SEPTENTRIOTOGLNG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEPTENTRIOTOGLNG&#160;&#160;&#160;300000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function. </p>
<p>Calls <a class="el" href="zephyr_8c.html#a26a5cd9326852a6f3a89225c8642479b" title="Performs module initialization. ">ZephyrInit()</a> to perform initialization then enters the main while loop where it .... the main loop stops, then <a class="el" href="zephyr_8c.html#a40809263d9e34d3d93cdb0eed73db857" title="Closes sockets and frees memory. ">ZephyrCleanup()</a> is called before exiting. </p>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00040">40</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a84b0f0a6d9c4b56b743eb5b171f3172c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84b0f0a6d9c4b56b743eb5b171f3172c">&#9670;&nbsp;</a></span>CloseLogFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CloseLogFile </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01496">1496</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00057">BCFILEERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8h_source.html#l00081">fp</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01517">NewFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;{</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordtype">int</span> i, index, err, ret;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    ret = <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span>(err = fclose(<a class="code" href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>))</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    {</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Error closing log file.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        ret = <a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    }</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keywordflow">if</span>(ret == <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Closed log files.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">return</span>(ret);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_abc2e895a6ef8c5a51ce9b7358e596f1b"><div class="ttname"><a href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a></div><div class="ttdeci">#define BCFILEERROR</div><div class="ttdoc">General file error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00057">roc2.h:57</a></div></div>
<div class="ttc" id="roc2_8h_html_aa065f30aa9f5f9a42132c82c787ee70b"><div class="ttname"><a href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">Pointer to open data file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00081">roc2.h:81</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a84b0f0a6d9c4b56b743eb5b171f3172c_icgraph.png" border="0" usemap="#zephyr_8c_a84b0f0a6d9c4b56b743eb5b171f3172c_icgraph" alt=""/></div>
<map name="zephyr_8c_a84b0f0a6d9c4b56b743eb5b171f3172c_icgraph" id="zephyr_8c_a84b0f0a6d9c4b56b743eb5b171f3172c_icgraph">
</map>
</div>

</div>
</div>
<a id="a5dbf303fd2c465b1e724a247623fdbd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dbf303fd2c465b1e724a247623fdbd2">&#9670;&nbsp;</a></span>CmdLineHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CmdLineHandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parses command line arguments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>Number of command line arguments passed to <a class="el" href="zephyr_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>. </td></tr>
    <tr><td class="paramname">argv[]</td><td>List of command line arguments passed to <a class="el" href="zephyr_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>BCSUCCESS if successful</li>
<li>BCERROR if there was an error parsing any of the command line options </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00903">903</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00033">BCERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8h_source.html#l00091">serial::bits</a>, <a class="el" href="roc2_8h_source.html#l00064">cloptions</a>, <a class="el" href="roc2_8h_source.html#l00079">file_len</a>, <a class="el" href="roc2_8h_source.html#l00094">serial::flow</a>, <a class="el" href="roc2_8c_source.html#l00799">get_baud()</a>, <a class="el" href="roc2_8h_source.html#l00099">gps_cmd</a>, <a class="el" href="roc2_8h_source.html#l00099">gps_data</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8h_source.html#l00092">serial::parity</a>, <a class="el" href="roc2_8h_source.html#l00089">serial::port</a>, <a class="el" href="roc2_8h_source.html#l00090">serial::speed</a>, <a class="el" href="roc2_8h_source.html#l00093">serial::stop</a>, <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="roc2_8c_source.html#l00854">verify_bits()</a>, <a class="el" href="roc2_8c_source.html#l00863">verify_flow()</a>, and <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    opterr=0;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    optind=0;   <span class="comment">// Reinitialize getopt()</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">while</span> ((i = getopt (argc, argv, <a class="code" href="roc2_8h.html#ac8ac8737a0d1260142bafa03c1f8e566">cloptions</a>)) != -1)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">switch</span> (i)</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:       <span class="comment">// &#39;v&#39; option turns on verbose mode</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                <a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = <a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">//          case &#39;l&#39;:       // &#39;l&#39; option specifies data file length</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">//              file_len=get_baud(atoi(optarg));</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">//              if((file_len &lt; 0) || (file_len &gt; 3600))</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">//              {</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">//                  fprintf(stderr, &quot;%s: Invalid file length setting %s\r\n&quot;, MODULE_NAME, optarg);</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">//                  return(BCERROR);</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">//              }</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">//              printf(&quot;File length = %d\r\n&quot;,file_len);</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">//              break;</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:       <span class="comment">// &#39;p&#39; option specifies serial port to use</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                free(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a> = malloc(strlen(optarg)+1);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                strcpy(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>, optarg);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a> == NULL)</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                    fprintf(stderr, <span class="stringliteral">&quot;%s: Error setting serial port to %s\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optarg);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                printf(<span class="stringliteral">&quot;Port = %s\r\n&quot;</span>,<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:       <span class="comment">// &#39;s&#39; option specifies serial port speed</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>=<a class="code" href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(atoi(optarg));</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>=<a class="code" href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(atoi(optarg));</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a> == <a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                    fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                printf(<span class="stringliteral">&quot;Speed = %d\r\n&quot;</span>,<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:       <span class="comment">// &#39;b&#39; option specifies serial port bit settings</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#adab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a>(optarg))</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a> = optarg[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a> = optarg[1];</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a> = optarg[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a> = optarg[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a> = optarg[1];</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a> = optarg[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                    fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                printf(<span class="stringliteral">&quot;Bits = %d, Par = %c, Stop = %d\r\n&quot;</span>,<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a>,<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:       <span class="comment">// &#39;f&#39; option specifies serial port flow control</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a10d59c21de300f9eae88f1b90ef845f2">verify_flow</a>(optarg))</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a> = optarg[0];</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                    <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a> = optarg[0];</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                    fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid flow control setting %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, optarg);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                }</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                printf(<span class="stringliteral">&quot;Flow = %c\r\n&quot;</span>,<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                <span class="keywordflow">if</span> ((optopt == <span class="charliteral">&#39;f&#39;</span>) || (optopt == <span class="charliteral">&#39;p&#39;</span>) || (optopt == <span class="charliteral">&#39;s&#39;</span>) || (optopt == <span class="charliteral">&#39;b&#39;</span>) || (optopt == <span class="charliteral">&#39;l&#39;</span>))</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                    fprintf (stderr, <span class="stringliteral">&quot;%s: Option -%c requires an argument.\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isprint (optopt))</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                    fprintf (stderr, <span class="stringliteral">&quot;%s: Unknown option `-%c&#39;.\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                    fprintf (stderr,<span class="stringliteral">&quot;%s: Unknown option character `\\x%x&#39;.\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,optopt);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        }</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div><div class="ttc" id="structserial_html_a366233b5459782dca82c5b5c28dcd066"><div class="ttname"><a href="structserial.html#a366233b5459782dca82c5b5c28dcd066">serial::speed</a></div><div class="ttdeci">int speed</div><div class="ttdoc">Serial baud rate. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00090">roc2.h:90</a></div></div>
<div class="ttc" id="structserial_html_a948f0bf5113570f168cd030c3a71a887"><div class="ttname"><a href="structserial.html#a948f0bf5113570f168cd030c3a71a887">serial::parity</a></div><div class="ttdeci">char parity</div><div class="ttdoc">Parity bit (&amp;#39;N&amp;#39;, &amp;#39;O&amp;#39;, or &amp;#39;E&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00092">roc2.h:92</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_ac8ac8737a0d1260142bafa03c1f8e566"><div class="ttname"><a href="roc2_8h.html#ac8ac8737a0d1260142bafa03c1f8e566">cloptions</a></div><div class="ttdeci">const char cloptions[16]</div><div class="ttdoc">List of valid command line options. A : indicates parameter required for that option. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00064">roc2.h:64</a></div></div>
<div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="zephyr_8c_html_a10d59c21de300f9eae88f1b90ef845f2"><div class="ttname"><a href="zephyr_8c.html#a10d59c21de300f9eae88f1b90ef845f2">verify_flow</a></div><div class="ttdeci">int verify_flow(const char *bits)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01341">zephyr.c:1341</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="structserial_html_a8a92bf8709c05cdaed2f888396296c2a"><div class="ttname"><a href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">serial::bits</a></div><div class="ttdeci">int bits</div><div class="ttdoc">Bits per character (7 or 8) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00091">roc2.h:91</a></div></div>
<div class="ttc" id="roc2_8h_html_a92d440cdd980e61a41b9238ca8d8cdc5"><div class="ttname"><a href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a></div><div class="ttdeci">#define BCERROR</div><div class="ttdoc">Indicates general error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00033">roc2.h:33</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="structserial_html_a543b38efa076f4c10ccaf7b597fd70c1"><div class="ttname"><a href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">serial::flow</a></div><div class="ttdeci">char flow</div><div class="ttdoc">Flow control (&amp;#39;N&amp;#39;, &amp;#39;H&amp;#39;, or &amp;#39;S&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00094">roc2.h:94</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="structserial_html_aa580759728df3298cdd37fef46459040"><div class="ttname"><a href="structserial.html#aa580759728df3298cdd37fef46459040">serial::port</a></div><div class="ttdeci">char * port</div><div class="ttdoc">Serial device name. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00089">roc2.h:89</a></div></div>
<div class="ttc" id="zephyr_8c_html_adab6d320323ece6f7627cb9bb04d0eb9"><div class="ttname"><a href="zephyr_8c.html#adab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a></div><div class="ttdeci">int verify_bits(const char *bits)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01332">zephyr.c:1332</a></div></div>
<div class="ttc" id="zephyr_8c_html_af890f66e1e86cf2e43aafd221eddabbd"><div class="ttname"><a href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a></div><div class="ttdeci">int get_baud(int baud)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01277">zephyr.c:1277</a></div></div>
<div class="ttc" id="structserial_html_ad9c26f97e179a67c08b8a0253c05bb58"><div class="ttname"><a href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">serial::stop</a></div><div class="ttdeci">int stop</div><div class="ttdoc">Number of stop bits (1 or 2) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00093">roc2.h:93</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_cgraph.png" border="0" usemap="#zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_cgraph" alt=""/></div>
<map name="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_cgraph" id="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_icgraph.png" border="0" usemap="#zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_icgraph" alt=""/></div>
<map name="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_icgraph" id="zephyr_8c_a5dbf303fd2c465b1e724a247623fdbd2_icgraph">
</map>
</div>

</div>
</div>
<a id="aa7865b0822633a51bd794f1922f39711"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7865b0822633a51bd794f1922f39711">&#9670;&nbsp;</a></span>ComputeCRC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short ComputeCRC </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01875">1875</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8c_source.html#l01861">CRC()</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01854">CRCComp()</a>, and <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>.</p>
<div class="fragment"><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;{</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> result;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    result = 0x1021;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">for</span>(i=0;i&lt;len;i++)</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    {</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        result=<a class="code" href="zephyr_8c.html#a626fb8bdfcd2bed45be4fe9fabb74f48">CRC</a>(result, data[i]);</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">return</span>(result);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;}</div><div class="ttc" id="zephyr_8c_html_a626fb8bdfcd2bed45be4fe9fabb74f48"><div class="ttname"><a href="zephyr_8c.html#a626fb8bdfcd2bed45be4fe9fabb74f48">CRC</a></div><div class="ttdeci">unsigned short CRC(unsigned short last, char next)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01861">zephyr.c:1861</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_aa7865b0822633a51bd794f1922f39711_cgraph.png" border="0" usemap="#zephyr_8c_aa7865b0822633a51bd794f1922f39711_cgraph" alt=""/></div>
<map name="zephyr_8c_aa7865b0822633a51bd794f1922f39711_cgraph" id="zephyr_8c_aa7865b0822633a51bd794f1922f39711_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_aa7865b0822633a51bd794f1922f39711_icgraph.png" border="0" usemap="#zephyr_8c_aa7865b0822633a51bd794f1922f39711_icgraph" alt=""/></div>
<map name="zephyr_8c_aa7865b0822633a51bd794f1922f39711_icgraph" id="zephyr_8c_aa7865b0822633a51bd794f1922f39711_icgraph">
</map>
</div>

</div>
</div>
<a id="a626fb8bdfcd2bed45be4fe9fabb74f48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a626fb8bdfcd2bed45be4fe9fabb74f48">&#9670;&nbsp;</a></span>CRC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short CRC </td>
          <td>(</td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>last</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>next</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01861">1861</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01875">ComputeCRC()</a>.</p>
<div class="fragment"><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;{</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> x, y;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    x = ((last&gt;&gt;8) ^ next) &amp; 0xff;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    x ^= x&gt;&gt;4;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    y = (last &lt;&lt; 8) ^ (x &lt;&lt; 12) ^ (x &lt;&lt;5) ^ x;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    y &amp;= 0xffff;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keywordflow">return</span>(y);</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a626fb8bdfcd2bed45be4fe9fabb74f48_icgraph.png" border="0" usemap="#zephyr_8c_a626fb8bdfcd2bed45be4fe9fabb74f48_icgraph" alt=""/></div>
<map name="zephyr_8c_a626fb8bdfcd2bed45be4fe9fabb74f48_icgraph" id="zephyr_8c_a626fb8bdfcd2bed45be4fe9fabb74f48_icgraph">
</map>
</div>

</div>
</div>
<a id="aabe674fb7d630daaebb86607af12308a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabe674fb7d630daaebb86607af12308a">&#9670;&nbsp;</a></span>CRCComp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CRCComp </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01854">1854</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8c_source.html#l01875">ComputeCRC()</a>, and <a class="el" href="zephyr_8h_source.html#l00157">crc_msg</a>.</p>
<div class="fragment"><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;{</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(data, len)==<a class="code" href="zephyr_8h.html#a5fbc376cbc0c53ee6f214ee2c5e18f33">crc_msg</a>) <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a5fbc376cbc0c53ee6f214ee2c5e18f33"><div class="ttname"><a href="zephyr_8h.html#a5fbc376cbc0c53ee6f214ee2c5e18f33">crc_msg</a></div><div class="ttdeci">unsigned short crc_msg</div><div class="ttdoc">CRC value from message. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00157">zephyr.h:157</a></div></div>
<div class="ttc" id="zephyr_8c_html_aa7865b0822633a51bd794f1922f39711"><div class="ttname"><a href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a></div><div class="ttdeci">unsigned short ComputeCRC(char *data, int len)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01875">zephyr.c:1875</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_aabe674fb7d630daaebb86607af12308a_cgraph.png" border="0" usemap="#zephyr_8c_aabe674fb7d630daaebb86607af12308a_cgraph" alt=""/></div>
<map name="zephyr_8c_aabe674fb7d630daaebb86607af12308a_cgraph" id="zephyr_8c_aabe674fb7d630daaebb86607af12308a_cgraph">
</map>
</div>

</div>
</div>
<a id="a0eaf55c523b081609cd85dd6eb04682b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0eaf55c523b081609cd85dd6eb04682b">&#9670;&nbsp;</a></span>CreateDayDirectory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CreateDayDirectory </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01410">1410</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, and <a class="el" href="roc2_8c_source.html#l00888">TodaysDirectoryPath()</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01460">OpenLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;{</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordtype">int</span> i, ret;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    ret = mkdir(<a class="code" href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>(), 0777);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">if</span>(ret)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keywordflow">if</span>(errno != EEXIST)     <span class="comment">// Existing directories not an error, anything else is</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        {</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            <span class="keywordflow">return</span>(errno);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        }</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="zephyr_8c_html_a29819f4927e98849304e948f13c12574"><div class="ttname"><a href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a></div><div class="ttdeci">char * TodaysDirectoryPath(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01365">zephyr.c:1365</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_cgraph.png" border="0" usemap="#zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_cgraph" alt=""/></div>
<map name="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_cgraph" id="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_icgraph.png" border="0" usemap="#zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_icgraph" alt=""/></div>
<map name="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_icgraph" id="zephyr_8c_a0eaf55c523b081609cd85dd6eb04682b_icgraph">
</map>
</div>

</div>
</div>
<a id="af890f66e1e86cf2e43aafd221eddabbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af890f66e1e86cf2e43aafd221eddabbd">&#9670;&nbsp;</a></span>get_baud()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_baud </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>baud</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01277">1277</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00033">BCERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00903">CmdLineHandler()</a>, and <a class="el" href="zephyr_8c_source.html#l01018">LoadConfigFileSettings()</a>.</p>
<div class="fragment"><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;{</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">switch</span> (baud) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">case</span> 300:</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordflow">return</span> B300;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">case</span> 600:</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">return</span> B600;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordflow">case</span> 1200:</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">return</span> B1200;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">case</span> 2400:</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="keywordflow">return</span> B2400;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">case</span> 4800:</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">return</span> B4800;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">case</span> 9600:</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">return</span> B9600;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordflow">case</span> 19200:</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">return</span> B19200;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">case</span> 38400:</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordflow">return</span> B38400;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordflow">case</span> 57600:</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="keywordflow">return</span> B57600;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">case</span> 115200:</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">return</span> B115200;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">case</span> 230400:</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keywordflow">return</span> B230400;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keywordflow">case</span> 460800:</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="keywordflow">return</span> B460800;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordflow">case</span> 500000:</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">return</span> B500000;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordflow">case</span> 576000:</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <span class="keywordflow">return</span> B576000;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">case</span> 921600:</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">return</span> B921600;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">case</span> 1000000:</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="keywordflow">return</span> B1000000;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">case</span> 1152000:</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">return</span> B1152000;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">case</span> 1500000:</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">return</span> B1500000;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">case</span> 2000000:</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">return</span> B2000000;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordflow">case</span> 2500000:</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">return</span> B2500000;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">case</span> 3000000:</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">return</span> B3000000;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">case</span> 3500000:</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">return</span> B3500000;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">case</span> 4000000:</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="keywordflow">return</span> B4000000;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">default</span>: </div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    }</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a92d440cdd980e61a41b9238ca8d8cdc5"><div class="ttname"><a href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a></div><div class="ttdeci">#define BCERROR</div><div class="ttdoc">Indicates general error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00033">roc2.h:33</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_af890f66e1e86cf2e43aafd221eddabbd_icgraph.png" border="0" usemap="#zephyr_8c_af890f66e1e86cf2e43aafd221eddabbd_icgraph" alt=""/></div>
<map name="zephyr_8c_af890f66e1e86cf2e43aafd221eddabbd_icgraph" id="zephyr_8c_af890f66e1e86cf2e43aafd221eddabbd_icgraph">
</map>
</div>

</div>
</div>
<a id="ab66e64dd30463cea0a06ac33c9cb3522"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab66e64dd30463cea0a06ac33c9cb3522">&#9670;&nbsp;</a></span>GetNextFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* GetNextFile </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01541">1541</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8h_source.html#l00105">discardFirstFile</a>, <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, <a class="el" href="zephyr_8h_source.html#l00203">getNextFile</a>, <a class="el" href="zephyr_8h_source.html#l00104">gotGPSChars</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8h_source.html#l00071">queueDir</a>, <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;{</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    DIR *dir;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keyword">struct </span>dirent *entry, *lastentry;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordtype">int</span> found;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordtype">char</span> *fullPath;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    </div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    found = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    dir = opendir(<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">if</span>(dir != NULL)</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordflow">while</span>((!found) &amp;&amp; (entry = readdir(dir)))</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            <span class="keywordflow">if</span>(strcmp(entry-&gt;d_name,<span class="stringliteral">&quot;list.txt&quot;</span>)==0)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                {</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                found = <a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                }</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        }</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        closedir(dir);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            dir = opendir(<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">while</span>((!found) &amp;&amp; (entry = readdir(dir)))</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            {</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                <span class="keywordflow">if</span>(entry-&gt;d_name[0] != <span class="charliteral">&#39;.&#39;</span>)</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                    {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                    found = <a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                    }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            }</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            closedir(dir);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        <span class="keywordflow">if</span>(found)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            fullPath= &amp;<a class="code" href="zephyr_8h.html#a2dc23420046ef8fdfba8feceb60aa1c0">getNextFile</a>[0];</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;            strcpy(fullPath,<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            strcpy(fullPath+strlen(<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>), <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            strcpy(fullPath+strlen(<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>)+1, entry-&gt;d_name);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            stat(fullPath, &amp;st);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="keywordflow">if</span> (strstr(fullPath,<span class="stringliteral">&quot;list.txt&quot;</span>)==0) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a>) {</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>) <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> += st.st_size;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: File Size = %d, Discard=%d\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, st.st_size, <a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a>);</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                <a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a> = 0;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            }</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            <span class="keywordflow">return</span>(fullPath);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        {</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <span class="keywordflow">return</span>(NULL);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    }</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a2dc23420046ef8fdfba8feceb60aa1c0"><div class="ttname"><a href="zephyr_8h.html#a2dc23420046ef8fdfba8feceb60aa1c0">getNextFile</a></div><div class="ttdeci">char getNextFile[100]</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00203">zephyr.h:203</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_af3e7ebf92f13594acf3ba281bcfd1c0b"><div class="ttname"><a href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a></div><div class="ttdeci">const char * queueDir</div><div class="ttdoc">hard coded for now, move to config file </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00071">roc2.h:71</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8h_html_af7f4cea1c772506355074b09428675b7"><div class="ttname"><a href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a></div><div class="ttdeci">int discardFirstFile</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00105">zephyr.h:105</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad3e6084a9ba20b4a2229e450de4b4cb1"><div class="ttname"><a href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a></div><div class="ttdeci">int gotGPSChars</div><div class="ttdoc">Flag to indicate GPS chars were received. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00104">zephyr.h:104</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_ab66e64dd30463cea0a06ac33c9cb3522_icgraph.png" border="0" usemap="#zephyr_8c_ab66e64dd30463cea0a06ac33c9cb3522_icgraph" alt=""/></div>
<map name="zephyr_8c_ab66e64dd30463cea0a06ac33c9cb3522_icgraph" id="zephyr_8c_ab66e64dd30463cea0a06ac33c9cb3522_icgraph">
</map>
</div>

</div>
</div>
<a id="a093f472d65a4478a2a23fa69ea593ef0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a093f472d65a4478a2a23fa69ea593ef0">&#9670;&nbsp;</a></span>gps_power()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gps_power </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01940">1940</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>, and <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;{</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    </div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">if</span>(state)</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    {</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_power 0&quot;</span>);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    }</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_power 1&quot;</span>);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    system(cmdstr);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a093f472d65a4478a2a23fa69ea593ef0_icgraph.png" border="0" usemap="#zephyr_8c_a093f472d65a4478a2a23fa69ea593ef0_icgraph" alt=""/></div>
<map name="zephyr_8c_a093f472d65a4478a2a23fa69ea593ef0_icgraph" id="zephyr_8c_a093f472d65a4478a2a23fa69ea593ef0_icgraph">
</map>
</div>

</div>
</div>
<a id="a450d4faa9f19206a09ccd2e461eff601"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a450d4faa9f19206a09ccd2e461eff601">&#9670;&nbsp;</a></span>gps_power_toggle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gps_power_toggle </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01974">1974</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;{</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    </div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <span class="keywordflow">if</span>(state)</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    {</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_pow_tog 0&quot;</span>);</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    {</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_pow_tog 1&quot;</span>);</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    }</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    system(cmdstr);</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="af1aef5309c25647017f7108bc58873f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1aef5309c25647017f7108bc58873f7">&#9670;&nbsp;</a></span>gps_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gps_reset </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01957">1957</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;{</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    </div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="keywordflow">if</span>(state)</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_reset 0&quot;</span>);</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    }</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gps_reset 1&quot;</span>);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    system(cmdstr);</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a6f9ac83f838130b9d2723d02ae37562e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f9ac83f838130b9d2723d02ae37562e">&#9670;&nbsp;</a></span>HandleGPS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleGPS </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00753">753</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;{</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Received GPS message.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a6f9ac83f838130b9d2723d02ae37562e_icgraph.png" border="0" usemap="#zephyr_8c_a6f9ac83f838130b9d2723d02ae37562e_icgraph" alt=""/></div>
<map name="zephyr_8c_a6f9ac83f838130b9d2723d02ae37562e_icgraph" id="zephyr_8c_a6f9ac83f838130b9d2723d02ae37562e_icgraph">
</map>
</div>

</div>
</div>
<a id="ac8252c63f3bdc239fbdf6fbd93d40c76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8252c63f3bdc239fbdf6fbd93d40c76">&#9670;&nbsp;</a></span>HandleIM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleIM </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>&lt; Switch to flight mode</p>
<p>&lt; Switch to Standby mode</p>
<p>&lt; Switch to Low Power mode</p>
<p>&lt; Switch to Safety mode</p>
<p>&lt; Switch to End Flight mode </p>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00570">570</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8h_source.html#l00131">EF</a>, <a class="el" href="zephyr_8h_source.html#l00127">FL</a>, <a class="el" href="zephyr_8h_source.html#l00137">IMAck</a>, <a class="el" href="zephyr_8h_source.html#l00151">LastMode</a>, <a class="el" href="zephyr_8h_source.html#l00129">LP</a>, <a class="el" href="zephyr_8h_source.html#l00091">modeSwitch</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00130">SA</a>, <a class="el" href="zephyr_8h_source.html#l00128">SB</a>, <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00099">waitingIM</a>, and <a class="el" href="zephyr_8h_source.html#l00092">wakeUpFlag</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordtype">char</span> modestr[3]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">char</span> *loc;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keyword">enum</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167">mode</a> newmode;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a> = 0;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    </div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    loc=strstr(msgdata, <span class="stringliteral">&quot;&lt;Mode&gt;&quot;</span>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (loc == 0) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: HandleIM &lt;Mode&gt; not found, ERROR!!!\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    strncpy(modestr,loc+strlen(<span class="stringliteral">&quot;&lt;Mode&gt;&quot;</span>),2);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Switching to mode %s\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, modestr);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="zephyr_8h.html#abb86b381a046a6c970fefe4d03cf08ad">LastMode</a> = InstMode;        <span class="comment">// Save current inst mode</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span>(strncmp(modestr, <span class="stringliteral">&quot;FL&quot;</span>, 2)==0)    </div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        newmode=<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7">FL</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(modestr, <span class="stringliteral">&quot;SB&quot;</span>, 2)==0)   </div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        newmode=<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a>;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(modestr, <span class="stringliteral">&quot;LP&quot;</span>, 2)==0)   </div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        newmode=<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(modestr, <span class="stringliteral">&quot;SA&quot;</span>, 2)==0)   </div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        newmode=<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349">SA</a>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(modestr, <span class="stringliteral">&quot;EF&quot;</span>, 2)==0)   </div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        newmode=<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748">EF</a>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Unknown mode change request: %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, modestr);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">return</span>(-1);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Now in mode %d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, newmode);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">if</span> ((InstMode != newmode) || (newmode==<a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349">SA</a>)) {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a> = 1;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">// Do wake up when coming out of LP,SA or EF since we may have been gone to SA or EF from LP</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">if</span> (InstMode == <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">//          if ((newmode == FL) || (newmode == SB)) {</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> = 1; <span class="comment">// only toggle wake up after low power mode</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">//          }</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">// Do wake up when coming out of SA or EF since we may have been gone to SA or EF from LP</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">//      if ((InstMode == SA) || (InstMode == EF)) {</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">//          wakeUpFlag = 1; // only toggle wake up after low power mode</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">//      }</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    } </div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    InstMode = newmode;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70">IMAck</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">//if(newmode==SA)</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">//{</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">//  SendMsg(S, &quot;&quot;, 0);      // We need to send an S msg every time Zephyr sends us IM.S</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">//}</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">//  nextImr = time(NULL) + 10000000;        // Set timer way into future so no more IMR msgs go out</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">//  return(newmode);</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a></div><div class="ttdoc">Low Power mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00129">zephyr.h:129</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748">EF</a></div><div class="ttdoc">End Flight. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00131">zephyr.h:131</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167">mode</a></div><div class="ttdeci">mode</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00126">zephyr.h:126</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349">SA</a></div><div class="ttdoc">Enter Safety Mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00130">zephyr.h:130</a></div></div>
<div class="ttc" id="zephyr_8h_html_a4388415ac8b79e24f68e40759a23651f"><div class="ttname"><a href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a></div><div class="ttdeci">int wakeUpFlag</div><div class="ttdoc">Notifies main loop to toggle wake up line. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00092">zephyr.h:92</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70">IMAck</a></div><div class="ttdoc">Instrument Mode Acknowledge (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00137">zephyr.h:137</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37b17e868a3191ab989eeb7dc8cd393"><div class="ttname"><a href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a></div><div class="ttdeci">int waitingIM</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00099">zephyr.h:99</a></div></div>
<div class="ttc" id="zephyr_8h_html_afd6a133642d784682fb4eb4c33ca2bd8"><div class="ttname"><a href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a></div><div class="ttdeci">int modeSwitch</div><div class="ttdoc">Notifies main loop when instrument mode is changed. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00091">zephyr.h:91</a></div></div>
<div class="ttc" id="zephyr_8h_html_abb86b381a046a6c970fefe4d03cf08ad"><div class="ttname"><a href="zephyr_8h.html#abb86b381a046a6c970fefe4d03cf08ad">LastMode</a></div><div class="ttdeci">enum mode InstMode LastMode</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00151">zephyr.h:151</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a></div><div class="ttdoc">StandBy Mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00128">zephyr.h:128</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6e021f179fc712de402af1043ca1a9ef"><div class="ttname"><a href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a></div><div class="ttdeci">void SendMsg(enum msg msgtype, char *payload, int payload_size)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01748">zephyr.c:1748</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7">FL</a></div><div class="ttdoc">Flight Mode (normal operation) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00127">zephyr.h:127</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_cgraph.png" border="0" usemap="#zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_cgraph" alt=""/></div>
<map name="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_cgraph" id="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_icgraph.png" border="0" usemap="#zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_icgraph" alt=""/></div>
<map name="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_icgraph" id="zephyr_8c_ac8252c63f3bdc239fbdf6fbd93d40c76_icgraph">
</map>
</div>

</div>
</div>
<a id="ac5b4e6f9b660a68301b5cd686040e61a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5b4e6f9b660a68301b5cd686040e61a">&#9670;&nbsp;</a></span>HandleSAck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleSAck </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00638">638</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00093">safeAck</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">char</span> ackstr[4]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordtype">char</span> *loc;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    </div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    loc=strstr(msgdata, <span class="stringliteral">&quot;&lt;Ack&gt;&quot;</span>);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (loc == 0) {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: HandleSAck &lt;Ack&gt; not found, ERROR!!!\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    strncpy(ackstr,loc+strlen(<span class="stringliteral">&quot;&lt;Ack&gt;&quot;</span>),3);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Ack is %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, ackstr);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span>(!strncmp(ackstr,<span class="stringliteral">&quot;ACK&quot;</span>,3)) </div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 1;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">else</span> </div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 0;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a>);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_ae7b49ade5fe88e53a5f0dda94ae94b23"><div class="ttname"><a href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a></div><div class="ttdeci">int safeAck</div><div class="ttdoc">Flag that indicates the Safety message has been acknowledged. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00093">zephyr.h:93</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_ac5b4e6f9b660a68301b5cd686040e61a_icgraph.png" border="0" usemap="#zephyr_8c_ac5b4e6f9b660a68301b5cd686040e61a_icgraph" alt=""/></div>
<map name="zephyr_8c_ac5b4e6f9b660a68301b5cd686040e61a_icgraph" id="zephyr_8c_ac5b4e6f9b660a68301b5cd686040e61a_icgraph">
</map>
</div>

</div>
</div>
<a id="a81340cc09bb1fbb59c968fa3d3b41064"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81340cc09bb1fbb59c968fa3d3b41064">&#9670;&nbsp;</a></span>HandleSW()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleSW </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00664">664</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Received shutdown warning.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a81340cc09bb1fbb59c968fa3d3b41064_icgraph.png" border="0" usemap="#zephyr_8c_a81340cc09bb1fbb59c968fa3d3b41064_icgraph" alt=""/></div>
<map name="zephyr_8c_a81340cc09bb1fbb59c968fa3d3b41064_icgraph" id="zephyr_8c_a81340cc09bb1fbb59c968fa3d3b41064_icgraph">
</map>
</div>

</div>
</div>
<a id="a24fd4d56749147dbdfbb5817276010a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24fd4d56749147dbdfbb5817276010a8">&#9670;&nbsp;</a></span>HandleTC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleTC </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00688">688</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8h_source.html#l00071">queueDir</a>, <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>, <a class="el" href="zephyr_8h_source.html#l00146">TCAck</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;{</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordtype">char</span> lenstr[8]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">char</span> cmdstr[128];</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">char</span> *loc, *payload, *filename;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordtype">int</span> len, doit;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    FILE *f;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    </div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    loc=strstr(msgdata, <span class="stringliteral">&quot;&lt;Length&gt;&quot;</span>);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (loc == 0) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: HandleTC &lt;Length&gt; not found, ERROR!!!\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    sscanf(loc+strlen(<span class="stringliteral">&quot;&lt;Length&gt;&quot;</span>),<span class="stringliteral">&quot;%d&quot;</span>,&amp;len);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Rcvd TC msg. Payload is %d bytes\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, len);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    payload=malloc(len);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    </div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    loc=strstr(msgdata, <span class="stringliteral">&quot;&lt;/CRC&gt;\n&quot;</span>)+strlen(<span class="stringliteral">&quot;&lt;/CRC&gt;\n&quot;</span>);     <span class="comment">// point to beginning of binary section</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">if</span> (loc == 0) {</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: HandleTC &lt;/CRC&gt; not found, ERROR!!!\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        free(payload);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">//printf(&quot;LOC:%c&quot;, loc[0]);</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    loc+=strlen(<span class="stringliteral">&quot;START&quot;</span>);                                   <span class="comment">// skip over binary section header</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    memcpy(payload, loc, len);                              <span class="comment">// copy payload into buffer</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">//printf(&quot;:%c:%2.2s\n&quot;, loc[0], payload);</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">/*  loc=strstr(payload,&quot;!!&quot;);                               // search for !! that separates filename from data</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">    filename=malloc(strlen(pathUpload)+(loc-payload));      // allocate space for name of upload file</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">    memcpy(filename, pathUpload, strlen(pathUpload));       // copy upload directory into filename</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">    memcpy(filename+strlen(pathUpload), payload, loc-payload);              // copy filename</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">    loc+=2;                                                 // point to beginning of data</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">    </span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">    f = fopen(filename, &quot;w&quot;);</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">    printf(&quot;Writing %s to file %s\r\n&quot;, loc, filename);</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">    fwrite(loc, 1, len-(loc-payload), f);</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">    fclose(f); */</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    </div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98">TCAck</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    </div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">if</span>(memmem(payload, len, <span class="stringliteral">&quot;ls&quot;</span>, strlen(<span class="stringliteral">&quot;ls&quot;</span>)))    <span class="comment">// do &quot;ls -1&quot; on queue and put results in file for offload</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;ls -l /data/roc/queue &gt; /data/roc/queue/list.txt&quot;</span>);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        doit=1;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(memmem(payload, len, <span class="stringliteral">&quot;reboot&quot;</span>, strlen(<span class="stringliteral">&quot;reboot&quot;</span>)))   <span class="comment">// reboot ROC</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;reboot&quot;</span>);   </div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        doit=1;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(memmem(payload, len, <span class="stringliteral">&quot;clear&quot;</span>, strlen(<span class="stringliteral">&quot;clear&quot;</span>))) <span class="comment">// clear download queue</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;rm %s/*&quot;</span>,<a class="code" href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        doit=0;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Executing command &#39;%s&#39;\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, cmdstr);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">if</span>(doit) system(cmdstr);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    </div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    free(payload);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">//  free(filename);</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_af3e7ebf92f13594acf3ba281bcfd1c0b"><div class="ttname"><a href="roc2_8h.html#af3e7ebf92f13594acf3ba281bcfd1c0b">queueDir</a></div><div class="ttdeci">const char * queueDir</div><div class="ttdoc">hard coded for now, move to config file </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00071">roc2.h:71</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6e021f179fc712de402af1043ca1a9ef"><div class="ttname"><a href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a></div><div class="ttdeci">void SendMsg(enum msg msgtype, char *payload, int payload_size)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01748">zephyr.c:1748</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98">TCAck</a></div><div class="ttdoc">Telecommand Acknowledge (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00146">zephyr.h:146</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_cgraph.png" border="0" usemap="#zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_cgraph" alt=""/></div>
<map name="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_cgraph" id="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_icgraph.png" border="0" usemap="#zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_icgraph" alt=""/></div>
<map name="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_icgraph" id="zephyr_8c_a24fd4d56749147dbdfbb5817276010a8_icgraph">
</map>
</div>

</div>
</div>
<a id="a405decabf57ea3d65a9fea453e4a2fa3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a405decabf57ea3d65a9fea453e4a2fa3">&#9670;&nbsp;</a></span>HandleTMAck()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int HandleTMAck </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00671">671</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;{</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordtype">char</span> ackstr[4]=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">char</span> *loc;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    loc=strstr(msgdata, <span class="stringliteral">&quot;&lt;Ack&gt;&quot;</span>);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> (loc == 0) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Handle TMAck &lt;Ack&gt; not found, ERROR!!!\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    strncpy(ackstr,loc+strlen(<span class="stringliteral">&quot;&lt;Ack&gt;&quot;</span>),3);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Ack is %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, ackstr);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span>(!strncmp(ackstr,<span class="stringliteral">&quot;ACK&quot;</span>,3)) <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a405decabf57ea3d65a9fea453e4a2fa3_icgraph.png" border="0" usemap="#zephyr_8c_a405decabf57ea3d65a9fea453e4a2fa3_icgraph" alt=""/></div>
<map name="zephyr_8c_a405decabf57ea3d65a9fea453e4a2fa3_icgraph" id="zephyr_8c_a405decabf57ea3d65a9fea453e4a2fa3_icgraph">
</map>
</div>

</div>
</div>
<a id="a94bb341ea8ea68eb26f43e8664513609"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94bb341ea8ea68eb26f43e8664513609">&#9670;&nbsp;</a></span>led()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void led </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l02008">2008</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00019">GREEN</a>, <a class="el" href="roc2_8h_source.html#l00017">OFF</a>, <a class="el" href="roc2_8h_source.html#l00020">ORANGE</a>, and <a class="el" href="roc2_8h_source.html#l00018">RED</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;{</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    </div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordflow">switch</span>(state)</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    {</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="roc2_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a>:</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 0&quot;</span>);</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 1&quot;</span>);</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="roc2_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>:</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 0&quot;</span>);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 1&quot;</span>);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="roc2_8h.html#ac5b6e19bf06822021f35602c59658de3">ORANGE</a>:</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 1&quot;</span>);</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 1&quot;</span>);</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>:</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led0 0&quot;</span>);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;            sprintf(cmdstr,<span class="stringliteral">&quot;gpio led1 0&quot;</span>);</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;            system(cmdstr);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    }       </div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a8d23feea868a983c8c2b661e1e16972f"><div class="ttname"><a href="roc2_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a></div><div class="ttdeci">#define RED</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00018">roc2.h:18</a></div></div>
<div class="ttc" id="roc2_8h_html_a29e413f6725b2ba32d165ffaa35b01e5"><div class="ttname"><a href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a></div><div class="ttdeci">#define OFF</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00017">roc2.h:17</a></div></div>
<div class="ttc" id="roc2_8h_html_acfbc006ea433ad708fdee3e82996e721"><div class="ttname"><a href="roc2_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a></div><div class="ttdeci">#define GREEN</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00019">roc2.h:19</a></div></div>
<div class="ttc" id="roc2_8h_html_ac5b6e19bf06822021f35602c59658de3"><div class="ttname"><a href="roc2_8h.html#ac5b6e19bf06822021f35602c59658de3">ORANGE</a></div><div class="ttdeci">#define ORANGE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00020">roc2.h:20</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a94bb341ea8ea68eb26f43e8664513609_icgraph.png" border="0" usemap="#zephyr_8c_a94bb341ea8ea68eb26f43e8664513609_icgraph" alt=""/></div>
<map name="zephyr_8c_a94bb341ea8ea68eb26f43e8664513609_icgraph" id="zephyr_8c_a94bb341ea8ea68eb26f43e8664513609_icgraph">
</map>
</div>

</div>
</div>
<a id="a8ed0e63e6cf78544f92b023037e3e7b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed0e63e6cf78544f92b023037e3e7b8">&#9670;&nbsp;</a></span>LoadConfigFileSettings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LoadConfigFileSettings </td>
          <td>(</td>
          <td class="paramtype">config_t *&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the program configuration file. </p>
<p>This function opens the module's configuration file (whose path is defined in the pathCfgRoc global) and reads the contents. The currently supported settings that can be placed in the config file are:</p><ul>
<li>(Optional) Port number to use for incoming socket connections (socket_in)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cfg</td><td>Pointer to config_t object for storing state of config file operations. </td></tr>
    <tr><td class="paramname">path</td><td>String containing full path of the config file to read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>BCSUCCESS if successful</li>
<li>BCCONFIGREADERROR indicates an error reading the configuration file </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01018">1018</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00023">BAUD_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00035">BCCONFIGREADERROR</a>, <a class="el" href="roc2_8h_source.html#l00033">BCERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8h_source.html#l00091">serial::bits</a>, <a class="el" href="roc2_8h_source.html#l00024">BITS_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00080">data_dir</a>, <a class="el" href="roc2_8h_source.html#l00029">DIR_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00079">file_len</a>, <a class="el" href="roc2_8h_source.html#l00028">FILE_LEN_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00094">serial::flow</a>, <a class="el" href="roc2_8h_source.html#l00025">FLOW_DEFAULT</a>, <a class="el" href="roc2_8c_source.html#l00799">get_baud()</a>, <a class="el" href="roc2_8h_source.html#l00099">gps_cmd</a>, <a class="el" href="roc2_8h_source.html#l00099">gps_data</a>, <a class="el" href="zephyr_8h_source.html#l00111">hwversion</a>, <a class="el" href="zephyr_8h_source.html#l00036">HWVERSION_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8h_source.html#l00092">serial::parity</a>, <a class="el" href="roc2_8h_source.html#l00089">serial::port</a>, <a class="el" href="roc2_8h_source.html#l00070">setting</a>, <a class="el" href="roc2_8h_source.html#l00090">serial::speed</a>, <a class="el" href="roc2_8h_source.html#l00093">serial::stop</a>, <a class="el" href="roc2_8h_source.html#l00095">serial::term</a>, <a class="el" href="roc2_8h_source.html#l00026">TERM_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="roc2_8c_source.html#l00854">verify_bits()</a>, <a class="el" href="roc2_8c_source.html#l00863">verify_flow()</a>, and <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;{</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordtype">int</span> count, i;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    config_init(cfg);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span>(config_read_file(cfg, path) == CONFIG_FALSE)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;%s: Error %s in config file %s, line %d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, config_error_text(cfg),config_error_file(cfg),config_error_line(cfg));</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        config_destroy(cfg);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#acc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a>);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    }</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;data_dir&quot;</span>);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        str = config_setting_get_string(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">if</span>(str != NULL)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a> = malloc(strlen(str)+1);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            strcpy(<a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>, str);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Data logged in %s.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        {</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid directory name %s in config file. Using default location %s\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str, <a class="code" href="roc2_8h.html#a5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a> = <a class="code" href="roc2_8h.html#a5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        }</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a> = <a class="code" href="roc2_8h.html#a5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;zeph_port&quot;</span>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        str = config_setting_get_string(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">if</span>(str != NULL)</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a> = malloc(strlen(str)+1);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            strcpy(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>, str);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: GPS commands on %s.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid device name %s in config file.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a> = NULL;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a> = NULL;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;zeph_speed&quot;</span>);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a> = <a class="code" href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a>(config_setting_get_int(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>));</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a> == <a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid baud rate %d in config file %s. Using default vaule %d.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>, path, <a class="code" href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a> = <a class="code" href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using baud rate %d for serial port %s from config file %s.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>, path);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    } </div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a> = <a class="code" href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;bits&quot;</span>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        str = config_setting_get_string(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#adab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a>(str))</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a> = str[0]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a> = str[1];</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a> = str[2]-<span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using serial bit settings %s.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        {</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid bits setting %s in config file. Using default value %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str, <a class="code" href="roc2_8h.html#a22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a>);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a> = 8;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a> = 1;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    }</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a> = 8;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a> = <span class="charliteral">&#39;N&#39;</span>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a> = 1;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;flow&quot;</span>);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        str = config_setting_get_string(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a10d59c21de300f9eae88f1b90ef845f2">verify_flow</a>(str))</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a> = str[0];</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Using %c flow control.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a>);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid flow control setting %c in config file. Using default value %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, str[0], <a class="code" href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a> = <a class="code" href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        }</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a> = <a class="code" href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;terminator&quot;</span>);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        str = config_setting_get_string(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">if</span>(str != NULL)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        {</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            strcpy(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">term</a>, str);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        {</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;%s: Invalid line terminator specified. Using default value\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            strcpy(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">term</a>, <a class="code" href="roc2_8h.html#ae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    {</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        strcpy(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">term</a>, <a class="code" href="roc2_8h.html#ae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a>);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;lp_mode&quot;</span>);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> = config_lookup(cfg, <span class="stringliteral">&quot;hwversion&quot;</span>);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a> != NULL)</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a> = config_setting_get_int(<a class="code" href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a>);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        printf(<span class="stringliteral">&quot;%s: Interface board version %d.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    } </div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a> = <a class="code" href="zephyr_8h.html#a374a75d2eadaf96cdf19950865c7373f">HWVERSION_DEFAULT</a>;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        printf(<span class="stringliteral">&quot;%s: No interface board version number found. Using default %d.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    config_destroy(cfg);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div><div class="ttc" id="structserial_html_a366233b5459782dca82c5b5c28dcd066"><div class="ttname"><a href="structserial.html#a366233b5459782dca82c5b5c28dcd066">serial::speed</a></div><div class="ttdeci">int speed</div><div class="ttdoc">Serial baud rate. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00090">roc2.h:90</a></div></div>
<div class="ttc" id="structserial_html_a948f0bf5113570f168cd030c3a71a887"><div class="ttname"><a href="structserial.html#a948f0bf5113570f168cd030c3a71a887">serial::parity</a></div><div class="ttdeci">char parity</div><div class="ttdoc">Parity bit (&amp;#39;N&amp;#39;, &amp;#39;O&amp;#39;, or &amp;#39;E&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00092">roc2.h:92</a></div></div>
<div class="ttc" id="roc2_8h_html_ae315cdbfa1dca5c4f0468fe98782056c"><div class="ttname"><a href="roc2_8h.html#ae315cdbfa1dca5c4f0468fe98782056c">TERM_DEFAULT</a></div><div class="ttdeci">#define TERM_DEFAULT</div><div class="ttdoc">Default line terminator. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00026">roc2.h:26</a></div></div>
<div class="ttc" id="zephyr_8h_html_a374a75d2eadaf96cdf19950865c7373f"><div class="ttname"><a href="zephyr_8h.html#a374a75d2eadaf96cdf19950865c7373f">HWVERSION_DEFAULT</a></div><div class="ttdeci">#define HWVERSION_DEFAULT</div><div class="ttdoc">Version number of interface board. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00036">zephyr.h:36</a></div></div>
<div class="ttc" id="roc2_8h_html_ad9fdf5915b4e8cea83af20712b77225c"><div class="ttname"><a href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a></div><div class="ttdeci">#define FLOW_DEFAULT</div><div class="ttdoc">Default flow control setting. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00025">roc2.h:25</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a22d8a5fa29f522516412a79347c65379"><div class="ttname"><a href="roc2_8h.html#a22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a></div><div class="ttdeci">#define BITS_DEFAULT</div><div class="ttdoc">Default serial data bits. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00024">roc2.h:24</a></div></div>
<div class="ttc" id="structserial_html_a0e0900b2aa9cf4d877b4b46b8fed744e"><div class="ttname"><a href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">serial::term</a></div><div class="ttdeci">char term[3]</div><div class="ttdoc">Line terminator. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00095">roc2.h:95</a></div></div>
<div class="ttc" id="zephyr_8h_html_afbce215e681be701ae5373fd692dd9ba"><div class="ttname"><a href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a></div><div class="ttdeci">int hwversion</div><div class="ttdoc">Version number of interface board. As of 6/10/18 ROC2.1 and 2.2 have version 2, ROC2.3 has version 3. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00111">zephyr.h:111</a></div></div>
<div class="ttc" id="roc2_8h_html_a12878be4d584d4841c7d409b8f024644"><div class="ttname"><a href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a></div><div class="ttdeci">char * data_dir</div><div class="ttdoc">Top level directory for logged data files. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00080">roc2.h:80</a></div></div>
<div class="ttc" id="zephyr_8c_html_a10d59c21de300f9eae88f1b90ef845f2"><div class="ttname"><a href="zephyr_8c.html#a10d59c21de300f9eae88f1b90ef845f2">verify_flow</a></div><div class="ttdeci">int verify_flow(const char *bits)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01341">zephyr.c:1341</a></div></div>
<div class="ttc" id="roc2_8h_html_a5d4e9da7ecf27d35f3194989053adee0"><div class="ttname"><a href="roc2_8h.html#a5d4e9da7ecf27d35f3194989053adee0">DIR_DEFAULT</a></div><div class="ttdeci">#define DIR_DEFAULT</div><div class="ttdoc">Default location to store data files. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00029">roc2.h:29</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_a13011473aa992ebdbad6b99830b54d56"><div class="ttname"><a href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a></div><div class="ttdeci">#define BAUD_DEFAULT</div><div class="ttdoc">Default serial port baud rate. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00023">roc2.h:23</a></div></div>
<div class="ttc" id="structserial_html_a8a92bf8709c05cdaed2f888396296c2a"><div class="ttname"><a href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">serial::bits</a></div><div class="ttdeci">int bits</div><div class="ttdoc">Bits per character (7 or 8) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00091">roc2.h:91</a></div></div>
<div class="ttc" id="roc2_8h_html_a92d440cdd980e61a41b9238ca8d8cdc5"><div class="ttname"><a href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a></div><div class="ttdeci">#define BCERROR</div><div class="ttdoc">Indicates general error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00033">roc2.h:33</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="roc2_8h_html_a7ae3c951fb9113513e6ceaafe61564b2"><div class="ttname"><a href="roc2_8h.html#a7ae3c951fb9113513e6ceaafe61564b2">setting</a></div><div class="ttdeci">config_setting_t * setting</div><div class="ttdoc">Pointer to a setting used by libconfig. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00070">roc2.h:70</a></div></div>
<div class="ttc" id="structserial_html_a543b38efa076f4c10ccaf7b597fd70c1"><div class="ttname"><a href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">serial::flow</a></div><div class="ttdeci">char flow</div><div class="ttdoc">Flow control (&amp;#39;N&amp;#39;, &amp;#39;H&amp;#39;, or &amp;#39;S&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00094">roc2.h:94</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="roc2_8h_html_acc734db768f05ebce6e4e985e44f46c5"><div class="ttname"><a href="roc2_8h.html#acc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a></div><div class="ttdeci">#define BCCONFIGREADERROR</div><div class="ttdoc">Indicates error reading configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00035">roc2.h:35</a></div></div>
<div class="ttc" id="structserial_html_aa580759728df3298cdd37fef46459040"><div class="ttname"><a href="structserial.html#aa580759728df3298cdd37fef46459040">serial::port</a></div><div class="ttdeci">char * port</div><div class="ttdoc">Serial device name. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00089">roc2.h:89</a></div></div>
<div class="ttc" id="zephyr_8c_html_adab6d320323ece6f7627cb9bb04d0eb9"><div class="ttname"><a href="zephyr_8c.html#adab6d320323ece6f7627cb9bb04d0eb9">verify_bits</a></div><div class="ttdeci">int verify_bits(const char *bits)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01332">zephyr.c:1332</a></div></div>
<div class="ttc" id="zephyr_8c_html_af890f66e1e86cf2e43aafd221eddabbd"><div class="ttname"><a href="zephyr_8c.html#af890f66e1e86cf2e43aafd221eddabbd">get_baud</a></div><div class="ttdeci">int get_baud(int baud)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01277">zephyr.c:1277</a></div></div>
<div class="ttc" id="structserial_html_ad9c26f97e179a67c08b8a0253c05bb58"><div class="ttname"><a href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">serial::stop</a></div><div class="ttdeci">int stop</div><div class="ttdoc">Number of stop bits (1 or 2) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00093">roc2.h:93</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_cgraph.png" border="0" usemap="#zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_cgraph" alt=""/></div>
<map name="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_cgraph" id="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_icgraph.png" border="0" usemap="#zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_icgraph" alt=""/></div>
<map name="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_icgraph" id="zephyr_8c_a8ed0e63e6cf78544f92b023037e3e7b8_icgraph">
</map>
</div>

</div>
</div>
<a id="af31e21e2ff935496c7ce8dc5e52b65c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af31e21e2ff935496c7ce8dc5e52b65c3">&#9670;&nbsp;</a></span>LogData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LogData </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01526">1526</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00057">BCFILEERROR</a>, and <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>.</p>
<div class="fragment"><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;{</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    </div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>==NULL)</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    {</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;%s: Error. Invalid log file stream\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    }</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    ret = fwrite(data, 1, n, <a class="code" href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    fflush(<a class="code" href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">return</span>(ret);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_abc2e895a6ef8c5a51ce9b7358e596f1b"><div class="ttname"><a href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a></div><div class="ttdeci">#define BCFILEERROR</div><div class="ttdoc">General file error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00057">roc2.h:57</a></div></div>
<div class="ttc" id="roc2_8h_html_aa065f30aa9f5f9a42132c82c787ee70b"><div class="ttname"><a href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">Pointer to open data file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00081">roc2.h:81</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45786db9b46a6cc20e64bd0a851655bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45786db9b46a6cc20e64bd0a851655bc">&#9670;&nbsp;</a></span>LogFileName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* LogFileName </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01425">1425</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00075">logFileName</a>, <a class="el" href="roc2_8h_source.html#l00086">now</a>, and <a class="el" href="roc2_8c_source.html#l00888">TodaysDirectoryPath()</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01460">OpenLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;{</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    time_t epoch;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keyword">struct </span>tm *<a class="code" href="roc2_8h.html#a133013525fac7907e0baa31ec30f8b4b">now</a>;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordtype">char</span> *rootname, *fullpath;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keyword">struct </span>timespec ts;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordtype">char</span> *filename = malloc(14 + 1 + strlen(name) + 4 + 1); <span class="comment">// format is YYYYMMDDhhmmss_name.txt</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span>(filename == NULL)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="keywordflow">return</span>(NULL);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    epoch = time(NULL);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">//  epoch = ts.tv_sec;</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    now = gmtime(&amp;epoch);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    sprintf(filename,<span class="stringliteral">&quot;%s_%04d%02d%02d%02d%02d%02d.sbf&quot;</span>, name, (now-&gt;tm_year)+1900, (now-&gt;tm_mon)+1, now-&gt;tm_mday, now-&gt;tm_hour, now-&gt;tm_min, now-&gt;tm_sec);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">if</span>((rootname = <a class="code" href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>()) == NULL)</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <span class="keywordflow">return</span>(NULL);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    }</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    fullpath = &amp;<a class="code" href="roc2_8h.html#a6195294dffffff6b11f3b629568b055e">logFileName</a>[0];</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    strcpy(fullpath, rootname);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">//  strcpy(fullpath + strlen(rootname), &quot;/&quot;);</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    strcpy(fullpath + strlen(rootname), filename);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    fullpath[strlen(rootname) + strlen(filename)] = 0;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    free (filename);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">return</span>(fullpath);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a6195294dffffff6b11f3b629568b055e"><div class="ttname"><a href="roc2_8h.html#a6195294dffffff6b11f3b629568b055e">logFileName</a></div><div class="ttdeci">char logFileName[100]</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00075">roc2.h:75</a></div></div>
<div class="ttc" id="zephyr_8c_html_a29819f4927e98849304e948f13c12574"><div class="ttname"><a href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a></div><div class="ttdeci">char * TodaysDirectoryPath(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01365">zephyr.c:1365</a></div></div>
<div class="ttc" id="roc2_8h_html_a133013525fac7907e0baa31ec30f8b4b"><div class="ttname"><a href="roc2_8h.html#a133013525fac7907e0baa31ec30f8b4b">now</a></div><div class="ttdeci">struct timespec now</div><div class="ttdoc">Stores current time. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00086">roc2.h:86</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_cgraph.png" border="0" usemap="#zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_cgraph" alt=""/></div>
<map name="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_cgraph" id="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_icgraph.png" border="0" usemap="#zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_icgraph" alt=""/></div>
<map name="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_icgraph" id="zephyr_8c_a45786db9b46a6cc20e64bd0a851655bc_icgraph">
</map>
</div>

</div>
</div>
<a id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00042">42</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="zephyr_8h_source.html#l00108">dataTm</a>, <a class="el" href="zephyr_8h_source.html#l00105">discardFirstFile</a>, <a class="el" href="zephyr_8h_source.html#l00131">EF</a>, <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, <a class="el" href="zephyr_8h_source.html#l00094">fileOffload</a>, <a class="el" href="zephyr_8h_source.html#l00127">FL</a>, <a class="el" href="roc2_8h_source.html#l00096">serial::fp</a>, <a class="el" href="zephyr_8c_source.html#l01541">GetNextFile()</a>, <a class="el" href="zephyr_8h_source.html#l00104">gotGPSChars</a>, <a class="el" href="zephyr_8c_source.html#l01940">gps_power()</a>, <a class="el" href="roc2_8h_source.html#l00019">GREEN</a>, <a class="el" href="zephyr_8h_source.html#l00111">hwversion</a>, <a class="el" href="zephyr_8h_source.html#l00135">IMR</a>, <a class="el" href="zephyr_8h_source.html#l00033">INBUFSIZE</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="zephyr_8c_source.html#l02008">led()</a>, <a class="el" href="zephyr_8h_source.html#l00018">LOWPOWERCHECK</a>, <a class="el" href="zephyr_8h_source.html#l00102">lowPowerCheck</a>, <a class="el" href="zephyr_8h_source.html#l00103">lowPowerCheckWait</a>, <a class="el" href="zephyr_8h_source.html#l00129">LP</a>, <a class="el" href="zephyr_8h_source.html#l00091">modeSwitch</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>, <a class="el" href="zephyr_8c_source.html#l01889">MsgType()</a>, <a class="el" href="zephyr_8h_source.html#l00110">nextImr</a>, <a class="el" href="zephyr_8h_source.html#l00106">nextMsgTime</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="roc2_8h_source.html#l00017">OFF</a>, <a class="el" href="roc2_8h_source.html#l00016">ON</a>, <a class="el" href="zephyr_8h_source.html#l00090">poweroffgps</a>, <a class="el" href="roc2_8h_source.html#l00078">quit</a>, <a class="el" href="roc2_8h_source.html#l00018">RED</a>, <a class="el" href="zephyr_8c_source.html#l01735">RemoveFile()</a>, <a class="el" href="zephyr_8h_source.html#l00138">S</a>, <a class="el" href="zephyr_8h_source.html#l00130">SA</a>, <a class="el" href="zephyr_8h_source.html#l00093">safeAck</a>, <a class="el" href="zephyr_8h_source.html#l00017">SAFETIMEOUT</a>, <a class="el" href="zephyr_8h_source.html#l00101">safeTimeout</a>, <a class="el" href="zephyr_8h_source.html#l00128">SB</a>, <a class="el" href="zephyr_8c_source.html#l01598">SendFile()</a>, <a class="el" href="zephyr_8h_source.html#l00089">sendIMRatPower</a>, <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>, <a class="el" href="zephyr_8c_source.html#l00040">SEPTENTRIOTOGLNG</a>, <a class="el" href="zephyr_8c_source.html#l01991">set_safe()</a>, <a class="el" href="zephyr_8h_source.html#l00107">shutdown</a>, <a class="el" href="roc2_8h_source.html#l00010">SWDate</a>, <a class="el" href="roc2_8h_source.html#l00011">SWVersion</a>, <a class="el" href="zephyr_8h_source.html#l00095">TCfileOffload</a>, <a class="el" href="zephyr_8h_source.html#l00109">TCflag</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>, <a class="el" href="zephyr_8c_source.html#l01666">TCSendFile()</a>, <a class="el" href="roc2_8h_source.html#l00095">serial::term</a>, <a class="el" href="zephyr_8h_source.html#l00143">TM</a>, <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00038">WAITFORACK</a>, <a class="el" href="zephyr_8h_source.html#l00039">WAITFORIM</a>, <a class="el" href="zephyr_8h_source.html#l00098">waitingAck</a>, <a class="el" href="zephyr_8h_source.html#l00099">waitingIM</a>, <a class="el" href="zephyr_8h_source.html#l00092">wakeUpFlag</a>, <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>, <a class="el" href="zephyr_8c_source.html#l00883">ZephyrCleanup()</a>, and <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">int</span> err, acked, i, numread, j;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *endptr, *readptr;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> term, readbuf[<a class="code" href="zephyr_8h.html#ab3f00dac33458432279d4308226d8413">INBUFSIZE</a>], linebuf[<a class="code" href="zephyr_8h.html#ab3f00dac33458432279d4308226d8413">INBUFSIZE</a>/2];</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keyword">struct </span>termios options;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//  struct timespec curTime;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    time_t Timer;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">char</span> *nextFile;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">enum</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a> InMsgType;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">char</span> InMsgTypeStr[8];</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    time_t nextS=0, nextTm=0;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">struct </span>pollfd fds[1];</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    err = <a class="code" href="zephyr_8c.html#a26a5cd9326852a6f3a89225c8642479b">ZephyrInit</a>(argc, argv);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//  led(RED);</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="zephyr_8h.html#af7d4b36cbbc4aa28f3f6c0e455b9b8bb">sendIMRatPower</a> = 1;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span>(err&lt;0)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Initialization error %d. Exiting\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,err);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>&gt;2) <a class="code" href="zephyr_8c.html#a94bb341ea8ea68eb26f43e8664513609">led</a>(<a class="code" href="roc2_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">else</span> </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        printf(<span class="stringliteral">&quot;SWVersion = %s\r\nSWDate = %s\r\n&quot;</span>,<a class="code" href="roc2_8h.html#ad6f212287232c8a7d12dbc0e5901635d">SWVersion</a>,<a class="code" href="roc2_8h.html#a8e5d9993745ca60b1777be3b1fa57a53">SWDate</a>);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        printf(<span class="stringliteral">&quot;%s: Module started.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//      write(zephyr.fp, &quot;ROC online\r\n&quot;, 12);</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>&gt;2) <a class="code" href="zephyr_8c.html#a94bb341ea8ea68eb26f43e8664513609">led</a>(<a class="code" href="roc2_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    term=<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">term</a>[strlen(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">term</a>)-1];</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    readptr=readbuf;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    memset(readbuf, 0, <span class="keyword">sizeof</span>(readbuf));</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    fds[0].fd = <a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    fds[0].events = POLLIN;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//  tcgetattr(serial.fp, &amp;options);                     // Get current port options</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//  options.c_cflag |= CREAD;                           // Enable the serial receiver</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//  tcflush(serial.fp,TCIOFLUSH);                       // Flush serial buffers</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//  if(tcsetattr(serial.fp, TCSANOW, &amp;options) == 0)    // Make the new settings active</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    Timer = time(NULL);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">while</span>(!<a class="code" href="roc2_8h.html#a2896431d6a80cd39b3d24b40237612ee">quit</a>)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span> (Timer != time(NULL)) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            Timer = time(NULL);     <span class="comment">// set for next second</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a> -= 1;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a>) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a> -= 1;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a>) { </div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> -= 1;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> == 0) { <span class="comment">// Haven&#39;t heard from Zephyr in over 2 hours, enter Standby mode</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    <a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> = <a class="code" href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    InstMode = <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 0;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">// This section checks to make sure we are not receiving chars in Low Power mode</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">// and that we are receiving chras in non-Low Power mode</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a>)   { </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a> -= 1;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a> == 0) { <span class="comment">// Check to make sure we are not receiing chars in Low Power mode</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a> = <a class="code" href="zephyr_8h.html#a052dadad9560c0874f9dfeedae0ccb3b">LOWPOWERCHECK</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                        printf(<span class="stringliteral">&quot;%s:%d: Check Mode %d Power State with %d GPS Chars: %d\r\n&quot;</span>,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                            <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, Timer, InstMode, <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a>, <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    <span class="keywordflow">if</span> (InstMode == <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a>) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> == 0) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> &gt; 100) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Got %d GPS Chars in LP Mode - Toggle Low Power Line\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                usleep(<a class="code" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>);   <span class="comment">// 300 msecs</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                            }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                            <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> = 0;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                            <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> = 5;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                            <a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a> = 1;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                            <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> -= 1;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                        }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> == 0) {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> &lt; 100) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Only %d GPS Chars in NON LP Mode - Toggle Low Power Line\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                usleep(<a class="code" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>);   <span class="comment">// 300 msecs</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                            <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> = 0;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                            <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> = 8;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                            <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> -= 1;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">//      if(time(NULL) == nextfile.tv_sec)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">//      {</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">//          nextfile.tv_sec+=file_len;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">//          NewFile();</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">//      }</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        usleep(200000);     <span class="comment">// sleep for 0.2s</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">//      if(time(NULL) &gt; ackTimeout) waitingAck=0;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">switch</span>(InstMode)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7">FL</a>:        <span class="comment">// Flight mode. Check for data files to offload</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">//      if (verbose) printf(&quot;%s: FL Set Safe Output to Low\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <a class="code" href="zephyr_8h.html#af7d4b36cbbc4aa28f3f6c0e455b9b8bb">sendIMRatPower</a> = 0;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        <a class="code" href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a>(<a class="code" href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio193/value&quot;</span>);         <span class="comment">// Set SAFE digital output to lo</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;</span>);         <span class="comment">// Set 5V On</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>)  <span class="comment">// coming out of low power mode, reset GPS</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>=0;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">// Sepentrio Wakeup</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a>) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                        <a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> = 0;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                        {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                            <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Entering FL mode. GPS power on.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                <a class="code" href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a>(<a class="code" href="roc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Toggle Wakeup to Septentrio - Flight Mode\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                usleep(<a class="code" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>);   <span class="comment">// 300 msecs</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> = 16;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                <a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a> = <a class="code" href="zephyr_8h.html#a052dadad9560c0874f9dfeedae0ccb3b">LOWPOWERCHECK</a>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> = 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>==0)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <span class="keywordflow">if</span>(nextFile = <a class="code" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a>())</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    <span class="keywordflow">if</span> (strstr(nextFile,<span class="stringliteral">&quot;list.txt&quot;</span>)) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 1;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>==<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>)      <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                        {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                            strcpy(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>, nextFile);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        <a class="code" href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a>(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 0;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>==<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>)      <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                        {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                            strcpy(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>, nextFile);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        <a class="code" href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a>(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a>:        <span class="comment">// Standby mode. Send IMR msg once per minute until we get an IM msg that forces a mode change</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a> = 0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> &amp;&amp; <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a>) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                        <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                            <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">//                              if (verbose) printf(&quot;%s: Entering SB mode. GPS power off.\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">//                              gps_power(OFF);</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Toggle Wakeup to Septentrio - Flight Mode\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                usleep(<a class="code" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>);   <span class="comment">// 300 msecs</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        <a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> = 0;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a> = 0;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    <a class="code" href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a> = time(NULL)+5;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">//      if (verbose) printf(&quot;%s: SB Set Safe Output to Low\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        <a class="code" href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a>(<a class="code" href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio193/value&quot;</span>);         <span class="comment">// Set SAFE digital output to lo</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;</span>);         <span class="comment">// Set 5V On</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">if</span>(time(NULL) &gt; <a class="code" href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a>)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#af7d4b36cbbc4aa28f3f6c0e455b9b8bb">sendIMRatPower</a>) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Sending IMR message\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        <a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a> = <a class="code" href="zephyr_8h.html#ae1fcb66a99d5c37f2935facbd0925ca0">WAITFORIM</a>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <a class="code" href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a> = time(NULL)+60;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">//              if(time(NULL) &gt; nextTm)</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">//              {</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">//                  if(verbose) printf(&quot;%s: Sending TM housekeeping message\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">//                  dataTm = 0;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">//                  SendMsg(TM, &quot;&quot;, 0);</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//                  nextTm = time(NULL)+60;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">//              }</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordflow">if</span>((nextFile = <a class="code" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a>()) &amp;&amp; !<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a> &amp;&amp; !<a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a>)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">if</span> (strstr(nextFile,<span class="stringliteral">&quot;list.txt&quot;</span>)) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 1;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>==<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>)      <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                            strcpy(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>, nextFile);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        <a class="code" href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a>(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>==<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>)  {   <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 0;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                            <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=<a class="code" href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                            <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(nextFile);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                            <a class="code" href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a>(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a>:        <span class="comment">// Low power mode. Put GPS in standby.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">//      if (verbose) printf(&quot;%s: LP Set Safe Output to Low\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        <a class="code" href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a>(<a class="code" href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio193/value&quot;</span>);         <span class="comment">// Set SAFE digital output to lo</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;</span>);         <span class="comment">// Set 5V off</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>)</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>=0;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">//                  system(&quot;echo \&quot;exePowerMode StandBy\&quot; &gt; /dev/ttyS3&quot;);       // Ugly hack for now (use this one for VM testing)</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">//                  if (verbose) printf(&quot;%s: Send Low Power Command to Septentrio\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">//                  system(&quot;echo \&quot;exePowerMode, StandBy\&quot; &gt; /dev/ttyAPP2&quot;);        // Ugly hack for now (use this one for flight HW)</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                        <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Entering LP mode. GPS off.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                            <a class="code" href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a>(<a class="code" href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Toggle Power Down to Septentrio - Flight Mode\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                            system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                            usleep(<a class="code" href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a>);   <span class="comment">// 300 msecs</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                            system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                    <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> = 5;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                    <a class="code" href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a> = 0;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a> = 1;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    <a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a> = 1;                                           <span class="comment">// Flag that power off command to GPS sent</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">//              nextImr = time(NULL) + 10000000;</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">//              nextTm = time(NULL)+60;</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="keywordflow">if</span>((nextFile = <a class="code" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a>()) &amp;&amp; !<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a> &amp;&amp; !<a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a>)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">if</span> (strstr(nextFile,<span class="stringliteral">&quot;list.txt&quot;</span>)) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 1;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>==<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>)      <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                        {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            strcpy(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>, nextFile);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                        <a class="code" href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a>(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 0;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>==<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>)  {   <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 0;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                            <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=<a class="code" href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                            <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(nextFile);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                            <a class="code" href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a>(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                        }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349">SA</a>:        <span class="comment">// Safety mode.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>&lt;3) system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;</span>);         <span class="comment">// Set 5V On</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    nextS = time(NULL) + 60;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 0;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670">S</a>, <span class="stringliteral">&quot;&quot;</span>, 0);      <span class="comment">// We need to send an S msg every time Zephyr sends us IM.S                 </span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a> = 0;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> &amp;&amp; <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a>) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Toggle Wakeup to Septentrio - Flight Mode\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio200/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                        usleep(500000); <span class="comment">// 500 msecs</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio200/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                        <a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> = 0;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                        <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a> = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <span class="keywordflow">if</span>((time(NULL) &gt; nextS) <span class="comment">/*&amp;&amp; !safeAck*/</span>)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670">S</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    nextS = time(NULL)+60;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 0;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">//              if (verbose) printf(&quot;%s: SA Set Safe Output to High\r\n&quot;, MODULE_NAME);</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        <a class="code" href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a>(<a class="code" href="roc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                        system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio193/value&quot;</span>);         <span class="comment">// Set SAFE digital output to high</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//              nextImr = time(NULL) + 10000000;</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="keywordflow">if</span> ((nextFile = <a class="code" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a>()) &amp;&amp; !<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    <span class="keywordflow">if</span> (strstr(nextFile,<span class="stringliteral">&quot;list.txt&quot;</span>)) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 1;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>==<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>)      <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                        {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                            strcpy(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>, nextFile);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        <a class="code" href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a>(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 0;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>==<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>)  {   <span class="comment">// we finished the previous file, starting a new one</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 0;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, <span class="stringliteral">&quot;&quot;</span>, 0);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                            <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=<a class="code" href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                            <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(nextFile);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                            <a class="code" href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a>(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                </div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748">EF</a>:        <span class="comment">// End flight mode. Shutdown, stop all Zephyr comms.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">//              system(&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;);         // Set 5V Off</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">//              shutdown = TRUE;    // I thought we were supposed to shut down here but that&#39;s apparently not correct.</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">//              quit=1;             // Just do nothing for now.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a>) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a> = 0;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">//                  system(&quot;echo \&quot; \&quot; &gt; /dev/ttyAPP2&quot;);        // wakeup</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">//              nextImr = time(NULL) + 10000000;</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="keywordflow">if</span>((nextFile = <a class="code" href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a>()) &amp;&amp; (<a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>==0))</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(nextFile);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                <a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> = <a class="code" href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        </div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span>(poll (fds, 1, 10)) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">//          if ((fds [1].revents &amp; POLLIN) || ((data_readptr-1) &gt; data_endptr))</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="keywordflow">if</span> (fds [0].revents &amp; POLLIN)       <span class="comment">// incoming data on Zephyr serial port</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                err = ioctl(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, FIONREAD, &amp;i);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="keywordflow">if</span>(err)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                    fprintf(stderr,<span class="stringliteral">&quot;%s: I/O error, exiting.&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    <a class="code" href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a> = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    <a class="code" href="roc2_8h.html#a2896431d6a80cd39b3d24b40237612ee">quit</a>=<a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">//          if(verbose) printf(&quot;%d bytes ready to read from %s\r\n&quot;,i, gps_data.port);</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                <span class="keywordflow">if</span>((readptr + i - readbuf) &gt; <a class="code" href="zephyr_8h.html#ab3f00dac33458432279d4308226d8413">INBUFSIZE</a>) <span class="comment">// Serial read will overrun buffer if we do it</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                    fprintf(stderr, <span class="stringliteral">&quot;%s: Serial buffer overrun. Data lost!\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    readptr=readbuf;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                    memset(readbuf, 0, <span class="keyword">sizeof</span>(readbuf));</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    <a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> = <a class="code" href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a>;  <span class="comment">// Enter safety mode if no data from Zephyr in 10 minutes</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">//              printf(&quot;readbuf=%x  readptr=%x\r\n&quot;,readbuf,readptr);</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    numread = read(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, readptr, i);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    readptr += numread;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">//              printf(&quot;first char = 0x%d\r\n&quot;,readbuf[0]);</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    <span class="keywordflow">if</span>(strstr(readbuf, <span class="stringliteral">&quot;&lt;/CRC&gt;\n&quot;</span>))         <span class="comment">// Found end of a message</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        readptr=readbuf;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(readbuf);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        fflush(stdout);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                        <span class="keywordflow">while</span>(endptr=strstr(readptr, <span class="stringliteral">&quot;&lt;/CRC&gt;\n&quot;</span>))</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                            sscanf(readptr,<span class="stringliteral">&quot;&lt;%s&gt;&quot;</span>,InMsgTypeStr);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                            InMsgTypeStr[strlen(InMsgTypeStr)-1]=0;     <span class="comment">// Remove trailing &gt;</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            InMsgType=<a class="code" href="zephyr_8c.html#a224d36d32fdd9a46fced3ac36c639169">MsgType</a>(InMsgTypeStr);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Received message type %d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, InMsgType);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                            <a class="code" href="zephyr_8c.html#a4420395a38828d6be4aae8646268d258">MsgHandler</a>(InMsgType, readbuf);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                            readptr=endptr+strlen(<span class="stringliteral">&quot;&lt;/CRC&gt;\n&quot;</span>);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                            <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec += 300000000;                       <span class="comment">// next message (1 sec from now)</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec &gt; 1000000000) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec -= 1000000000;                      <span class="comment">// next message (1 sec from now)</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_sec += 1;                        <span class="comment">// next message (1 sec from now)</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                            }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        readptr=readbuf;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        memset(readbuf, 0, <span class="keyword">sizeof</span>(readbuf));</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                    }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">//                  printf(&quot;read %d bytes\r\n&quot;,numread);</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">//                  printf(readbuf);</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">//                  fflush(stdout);</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        </div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        } </div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">//      else</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">//      {</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">//          if(time(NULL) &gt; safeTimeout)    // Haven&#39;t heard from Zephyr in over 2 hours, enter Safety mode</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">//          {</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">//              InstMode = SA;</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">//          }</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">//      }</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="zephyr_8c.html#a40809263d9e34d3d93cdb0eed73db857">ZephyrCleanup</a>();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    printf(<span class="stringliteral">&quot;%s: Module stopped.\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    exit(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a417c69b8c9313307f484fd52ea61db84">LP</a></div><div class="ttdoc">Low Power mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00129">zephyr.h:129</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a9b01ce700b7e6a55a2bd1f0b5c0be748">EF</a></div><div class="ttdoc">End Flight. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00131">zephyr.h:131</a></div></div>
<div class="ttc" id="zephyr_8h_html_afe4816e53e5d7a1264d7b0eec60b7eb9"><div class="ttname"><a href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a></div><div class="ttdeci">struct timespec nextMsgTime</div><div class="ttdoc">Earliest time that is OK to send the next message (no more than once/sec) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00106">zephyr.h:106</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="roc2_8h_html_a8d23feea868a983c8c2b661e1e16972f"><div class="ttname"><a href="roc2_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a></div><div class="ttdeci">#define RED</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00018">roc2.h:18</a></div></div>
<div class="ttc" id="zephyr_8c_html_a184ae444081beacfe0bd5b712d378b59"><div class="ttname"><a href="zephyr_8c.html#a184ae444081beacfe0bd5b712d378b59">SendFile</a></div><div class="ttdeci">int SendFile(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01598">zephyr.c:1598</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ac4d318ef07bfe697b043d75065f90349">SA</a></div><div class="ttdoc">Enter Safety Mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00130">zephyr.h:130</a></div></div>
<div class="ttc" id="zephyr_8h_html_ae7b49ade5fe88e53a5f0dda94ae94b23"><div class="ttname"><a href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a></div><div class="ttdeci">int safeAck</div><div class="ttdoc">Flag that indicates the Safety message has been acknowledged. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00093">zephyr.h:93</a></div></div>
<div class="ttc" id="zephyr_8c_html_ab66e64dd30463cea0a06ac33c9cb3522"><div class="ttname"><a href="zephyr_8c.html#ab66e64dd30463cea0a06ac33c9cb3522">GetNextFile</a></div><div class="ttdeci">char * GetNextFile(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01541">zephyr.c:1541</a></div></div>
<div class="ttc" id="roc2_8h_html_a29e413f6725b2ba32d165ffaa35b01e5"><div class="ttname"><a href="roc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">OFF</a></div><div class="ttdeci">#define OFF</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00017">roc2.h:17</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670">S</a></div><div class="ttdoc">Safety mode reached (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00138">zephyr.h:138</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad9de7f17717cd6e46d8f5f4e869a4bd1"><div class="ttname"><a href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a></div><div class="ttdeci">char fileOffload[100]</div><div class="ttdoc">Stores the name of the file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00094">zephyr.h:94</a></div></div>
<div class="ttc" id="zephyr_8c_html_abf9cb423a606dc4f8232d1b3394042d5"><div class="ttname"><a href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a></div><div class="ttdeci">int RemoveFile(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01735">zephyr.c:1735</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a></div><div class="ttdoc">Telemetry Message (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00143">zephyr.h:143</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac380ae62365b5574461d06a4c004d681"><div class="ttname"><a href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a></div><div class="ttdeci">int safeTimeout</div><div class="ttdoc">Time at which ROC enters Safe mode if it hasn&amp;#39;t heard from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00101">zephyr.h:101</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="zephyr_8h_html_a4388415ac8b79e24f68e40759a23651f"><div class="ttname"><a href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a></div><div class="ttdeci">int wakeUpFlag</div><div class="ttdoc">Notifies main loop to toggle wake up line. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00092">zephyr.h:92</a></div></div>
<div class="ttc" id="zephyr_8c_html_a94bb341ea8ea68eb26f43e8664513609"><div class="ttname"><a href="zephyr_8c.html#a94bb341ea8ea68eb26f43e8664513609">led</a></div><div class="ttdeci">void led(int state)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l02008">zephyr.c:2008</a></div></div>
<div class="ttc" id="roc2_8h_html_a2896431d6a80cd39b3d24b40237612ee"><div class="ttname"><a href="roc2_8h.html#a2896431d6a80cd39b3d24b40237612ee">quit</a></div><div class="ttdeci">int quit</div><div class="ttdoc">Tells the main loop when to exit. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00078">roc2.h:78</a></div></div>
<div class="ttc" id="zephyr_8h_html_ab3f00dac33458432279d4308226d8413"><div class="ttname"><a href="zephyr_8h.html#ab3f00dac33458432279d4308226d8413">INBUFSIZE</a></div><div class="ttdeci">#define INBUFSIZE</div><div class="ttdoc">Size of incoming serial buffer. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00033">zephyr.h:33</a></div></div>
<div class="ttc" id="zephyr_8c_html_a093f472d65a4478a2a23fa69ea593ef0"><div class="ttname"><a href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a></div><div class="ttdeci">void gps_power(int state)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01940">zephyr.c:1940</a></div></div>
<div class="ttc" id="roc2_8h_html_ad76d1750a6cdeebd506bfcd6752554d2"><div class="ttname"><a href="roc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a></div><div class="ttdeci">#define ON</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00016">roc2.h:16</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37b17e868a3191ab989eeb7dc8cd393"><div class="ttname"><a href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a></div><div class="ttdeci">int waitingIM</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00099">zephyr.h:99</a></div></div>
<div class="ttc" id="structserial_html_a0e0900b2aa9cf4d877b4b46b8fed744e"><div class="ttname"><a href="structserial.html#a0e0900b2aa9cf4d877b4b46b8fed744e">serial::term</a></div><div class="ttdeci">char term[3]</div><div class="ttdoc">Line terminator. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00095">roc2.h:95</a></div></div>
<div class="ttc" id="zephyr_8h_html_a3b02c8218b4fda72755b780d51977c38"><div class="ttname"><a href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a></div><div class="ttdeci">#define SAFETIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00017">zephyr.h:17</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3e"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a></div><div class="ttdeci">msg</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00134">zephyr.h:134</a></div></div>
<div class="ttc" id="zephyr_8h_html_a5b3e85b8b041c8b4a422f22faa6f87be"><div class="ttname"><a href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a></div><div class="ttdeci">time_t nextImr</div><div class="ttdoc">Timer that keeps track of when to send out IMR messages until it gets a response. ...</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00110">zephyr.h:110</a></div></div>
<div class="ttc" id="roc2_8h_html_acfbc006ea433ad708fdee3e82996e721"><div class="ttname"><a href="roc2_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a></div><div class="ttdeci">#define GREEN</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00019">roc2.h:19</a></div></div>
<div class="ttc" id="zephyr_8h_html_afbce215e681be701ae5373fd692dd9ba"><div class="ttname"><a href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a></div><div class="ttdeci">int hwversion</div><div class="ttdoc">Version number of interface board. As of 6/10/18 ROC2.1 and 2.2 have version 2, ROC2.3 has version 3. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00111">zephyr.h:111</a></div></div>
<div class="ttc" id="zephyr_8h_html_afd6a133642d784682fb4eb4c33ca2bd8"><div class="ttname"><a href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a></div><div class="ttdeci">int modeSwitch</div><div class="ttdoc">Notifies main loop when instrument mode is changed. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00091">zephyr.h:91</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac292f396289364d78037cae452f1aefc"><div class="ttname"><a href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a></div><div class="ttdeci">int waitingAck</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00098">zephyr.h:98</a></div></div>
<div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="zephyr_8c_html_a7e696bce041fca9cc1924bcd65cbc503"><div class="ttname"><a href="zephyr_8c.html#a7e696bce041fca9cc1924bcd65cbc503">set_safe</a></div><div class="ttdeci">void set_safe(int state)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01991">zephyr.c:1991</a></div></div>
<div class="ttc" id="zephyr_8h_html_a5161d377a61befc3f8103e794d5cb582"><div class="ttname"><a href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a></div><div class="ttdeci">int shutdown</div><div class="ttdoc">Indicates whether system should shutdown after this process ends. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00107">zephyr.h:107</a></div></div>
<div class="ttc" id="zephyr_8h_html_a052dadad9560c0874f9dfeedae0ccb3b"><div class="ttname"><a href="zephyr_8h.html#a052dadad9560c0874f9dfeedae0ccb3b">LOWPOWERCHECK</a></div><div class="ttdeci">#define LOWPOWERCHECK</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00018">zephyr.h:18</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a></div><div class="ttdoc">StandBy Mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00128">zephyr.h:128</a></div></div>
<div class="ttc" id="structserial_html_a5794fd6ed295d17d7c80293f11f41b6b"><div class="ttname"><a href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">serial::fp</a></div><div class="ttdeci">int fp</div><div class="ttdoc">File descriptor for open serial port. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00096">roc2.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_ade6c9212e8175f2f26cb4ffa27f6f71c"><div class="ttname"><a href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a></div><div class="ttdeci">int TCflag</div><div class="ttdoc">Flag TC data transfer. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00109">zephyr.h:109</a></div></div>
<div class="ttc" id="roc2_8h_html_a8e5d9993745ca60b1777be3b1fa57a53"><div class="ttname"><a href="roc2_8h.html#a8e5d9993745ca60b1777be3b1fa57a53">SWDate</a></div><div class="ttdeci">#define SWDate</div><div class="ttdoc">Build date and time. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00010">roc2.h:10</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9ad65e907dc15f9fd37da381332b2f1f"><div class="ttname"><a href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a></div><div class="ttdeci">int dataTm</div><div class="ttdoc">Indicates whether the last TM message sent contains offload data. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00108">zephyr.h:108</a></div></div>
<div class="ttc" id="zephyr_8c_html_a224d36d32fdd9a46fced3ac36c639169"><div class="ttname"><a href="zephyr_8c.html#a224d36d32fdd9a46fced3ac36c639169">MsgType</a></div><div class="ttdeci">enum msg MsgType(char *typestr)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01889">zephyr.c:1889</a></div></div>
<div class="ttc" id="zephyr_8c_html_a26a5cd9326852a6f3a89225c8642479b"><div class="ttname"><a href="zephyr_8c.html#a26a5cd9326852a6f3a89225c8642479b">ZephyrInit</a></div><div class="ttdeci">int ZephyrInit(int argc, char *argv[])</div><div class="ttdoc">Performs module initialization. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00775">zephyr.c:775</a></div></div>
<div class="ttc" id="zephyr_8c_html_af672e15ff453fe857ab4ce7de925f34a"><div class="ttname"><a href="zephyr_8c.html#af672e15ff453fe857ab4ce7de925f34a">TCSendFile</a></div><div class="ttdeci">int TCSendFile(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01666">zephyr.c:1666</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="zephyr_8c_html_a4420395a38828d6be4aae8646268d258"><div class="ttname"><a href="zephyr_8c.html#a4420395a38828d6be4aae8646268d258">MsgHandler</a></div><div class="ttdeci">int MsgHandler(enum msg msgtype, char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00514">zephyr.c:514</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a></div><div class="ttdoc">Instrument Mode Request (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00135">zephyr.h:135</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
<div class="ttc" id="zephyr_8c_html_a40809263d9e34d3d93cdb0eed73db857"><div class="ttname"><a href="zephyr_8c.html#a40809263d9e34d3d93cdb0eed73db857">ZephyrCleanup</a></div><div class="ttdeci">int ZephyrCleanup(void)</div><div class="ttdoc">Closes sockets and frees memory. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00883">zephyr.c:883</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6e021f179fc712de402af1043ca1a9ef"><div class="ttname"><a href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a></div><div class="ttdeci">void SendMsg(enum msg msgtype, char *payload, int payload_size)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01748">zephyr.c:1748</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7f970a76fd7cbf3dd6143df7262bbccc"><div class="ttname"><a href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a></div><div class="ttdeci">#define WAITFORACK</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00038">zephyr.h:38</a></div></div>
<div class="ttc" id="zephyr_8h_html_af7f4cea1c772506355074b09428675b7"><div class="ttname"><a href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a></div><div class="ttdeci">int discardFirstFile</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00105">zephyr.h:105</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad4d4536ebc16bcd99fca3934346c8372"><div class="ttname"><a href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a></div><div class="ttdeci">int poweroffgps</div><div class="ttdoc">flags that we have sent power command to GPS </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00090">zephyr.h:90</a></div></div>
<div class="ttc" id="zephyr_8h_html_af7d4b36cbbc4aa28f3f6c0e455b9b8bb"><div class="ttname"><a href="zephyr_8h.html#af7d4b36cbbc4aa28f3f6c0e455b9b8bb">sendIMRatPower</a></div><div class="ttdeci">int sendIMRatPower</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00089">zephyr.h:89</a></div></div>
<div class="ttc" id="zephyr_8h_html_ae1fcb66a99d5c37f2935facbd0925ca0"><div class="ttname"><a href="zephyr_8h.html#ae1fcb66a99d5c37f2935facbd0925ca0">WAITFORIM</a></div><div class="ttdeci">#define WAITFORIM</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00039">zephyr.h:39</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9de05a1c8882446cef651d95cb8c03f8"><div class="ttname"><a href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a></div><div class="ttdeci">char TCfileOffload[100]</div><div class="ttdoc">Stores the name of the TC file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00095">zephyr.h:95</a></div></div>
<div class="ttc" id="zephyr_8h_html_a52ca9e601c9d0389607ec95f1c49215e"><div class="ttname"><a href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a></div><div class="ttdeci">int lowPowerCheck</div><div class="ttdoc">Time interval at which we check the low power state. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00102">zephyr.h:102</a></div></div>
<div class="ttc" id="zephyr_8c_html_a777ab160b5ad985f2ccc1a878e5936fd"><div class="ttname"><a href="zephyr_8c.html#a777ab160b5ad985f2ccc1a878e5936fd">SEPTENTRIOTOGLNG</a></div><div class="ttdeci">#define SEPTENTRIOTOGLNG</div><div class="ttdoc">Main function. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00040">zephyr.c:40</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad3e6084a9ba20b4a2229e450de4b4cb1"><div class="ttname"><a href="zephyr_8h.html#ad3e6084a9ba20b4a2229e450de4b4cb1">gotGPSChars</a></div><div class="ttdeci">int gotGPSChars</div><div class="ttdoc">Flag to indicate GPS chars were received. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00104">zephyr.h:104</a></div></div>
<div class="ttc" id="roc2_8h_html_ad6f212287232c8a7d12dbc0e5901635d"><div class="ttname"><a href="roc2_8h.html#ad6f212287232c8a7d12dbc0e5901635d">SWVersion</a></div><div class="ttdeci">#define SWVersion</div><div class="ttdoc">Software version number. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00011">roc2.h:11</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167a23f8b9ced0e0612b05e87ffd678d19f7">FL</a></div><div class="ttdoc">Flight Mode (normal operation) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00127">zephyr.h:127</a></div></div>
<div class="ttc" id="zephyr_8h_html_af8bedab821ee7f36762a64ac71e914a4"><div class="ttname"><a href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a></div><div class="ttdeci">int lowPowerCheckWait</div><div class="ttdoc">Flag to hold off low power check. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00103">zephyr.h:103</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#zephyr_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" alt=""/></div>
<map name="zephyr_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" id="zephyr_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph">
</map>
</div>

</div>
</div>
<a id="a4420395a38828d6be4aae8646268d258"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4420395a38828d6be4aae8646268d258">&#9670;&nbsp;</a></span>MsgHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MsgHandler </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a>&#160;</td>
          <td class="paramname"><em>msgtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msgdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00514">514</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8h_source.html#l00108">dataTm</a>, <a class="el" href="zephyr_8h_source.html#l00094">fileOffload</a>, <a class="el" href="zephyr_8h_source.html#l00147">GPS</a>, <a class="el" href="zephyr_8c_source.html#l00753">HandleGPS()</a>, <a class="el" href="zephyr_8c_source.html#l00570">HandleIM()</a>, <a class="el" href="zephyr_8c_source.html#l00638">HandleSAck()</a>, <a class="el" href="zephyr_8c_source.html#l00664">HandleSW()</a>, <a class="el" href="zephyr_8c_source.html#l00688">HandleTC()</a>, <a class="el" href="zephyr_8c_source.html#l00671">HandleTMAck()</a>, <a class="el" href="zephyr_8h_source.html#l00136">IM</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="zephyr_8c_source.html#l01735">RemoveFile()</a>, <a class="el" href="zephyr_8h_source.html#l00139">SAck</a>, <a class="el" href="zephyr_8h_source.html#l00140">SW</a>, <a class="el" href="zephyr_8h_source.html#l00145">TC</a>, <a class="el" href="zephyr_8h_source.html#l00095">TCfileOffload</a>, <a class="el" href="zephyr_8h_source.html#l00109">TCflag</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>, <a class="el" href="zephyr_8h_source.html#l00144">TMAck</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, and <a class="el" href="zephyr_8h_source.html#l00098">waitingAck</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">switch</span>(msgtype)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5">IM</a>:</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="zephyr_8c.html#ac8252c63f3bdc239fbdf6fbd93d40c76">HandleIM</a>(msgdata));</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43">SAck</a>:</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="zephyr_8c.html#ac5b4e6f9b660a68301b5cd686040e61a">HandleSAck</a>(msgdata));</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2">SW</a>:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="zephyr_8c.html#a81340cc09bb1fbb59c968fa3d3b41064">HandleSW</a>(msgdata));</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df">TMAck</a>:</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a405decabf57ea3d65a9fea453e4a2fa3">HandleTMAck</a>(msgdata))</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=0;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a>)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a>) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        <a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>++;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Rcvd TMAck. File %s Part %d/%d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>,<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>,<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>==<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>)      <span class="comment">// done with file transfer</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                        {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                            <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                            <a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a> = 0;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                        <a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>++;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Rcvd TMAck. File %s Part %d/%d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>,<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>,<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>==<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>)      <span class="comment">// done with file transfer</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                        {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                            <a class="code" href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a>(<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        }                       </div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                    <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840">TC</a>:</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="zephyr_8c.html#a24fd4d56749147dbdfbb5817276010a8">HandleTC</a>(msgdata));</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182">GPS</a>:</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="zephyr_8c.html#a6f9ac83f838130b9d2723d02ae37562e">HandleGPS</a>(msgdata));</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            <span class="keywordflow">return</span>(-1);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840">TC</a></div><div class="ttdoc">Telecommand (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00145">zephyr.h:145</a></div></div>
<div class="ttc" id="zephyr_8c_html_a81340cc09bb1fbb59c968fa3d3b41064"><div class="ttname"><a href="zephyr_8c.html#a81340cc09bb1fbb59c968fa3d3b41064">HandleSW</a></div><div class="ttdeci">int HandleSW(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00664">zephyr.c:664</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad9de7f17717cd6e46d8f5f4e869a4bd1"><div class="ttname"><a href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a></div><div class="ttdeci">char fileOffload[100]</div><div class="ttdoc">Stores the name of the file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00094">zephyr.h:94</a></div></div>
<div class="ttc" id="zephyr_8c_html_abf9cb423a606dc4f8232d1b3394042d5"><div class="ttname"><a href="zephyr_8c.html#abf9cb423a606dc4f8232d1b3394042d5">RemoveFile</a></div><div class="ttdeci">int RemoveFile(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01735">zephyr.c:1735</a></div></div>
<div class="ttc" id="zephyr_8c_html_a405decabf57ea3d65a9fea453e4a2fa3"><div class="ttname"><a href="zephyr_8c.html#a405decabf57ea3d65a9fea453e4a2fa3">HandleTMAck</a></div><div class="ttdeci">int HandleTMAck(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00671">zephyr.c:671</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182">GPS</a></div><div class="ttdoc">GPS Data (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00147">zephyr.h:147</a></div></div>
<div class="ttc" id="zephyr_8c_html_ac8252c63f3bdc239fbdf6fbd93d40c76"><div class="ttname"><a href="zephyr_8c.html#ac8252c63f3bdc239fbdf6fbd93d40c76">HandleIM</a></div><div class="ttdeci">int HandleIM(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00570">zephyr.c:570</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6f9ac83f838130b9d2723d02ae37562e"><div class="ttname"><a href="zephyr_8c.html#a6f9ac83f838130b9d2723d02ae37562e">HandleGPS</a></div><div class="ttdeci">int HandleGPS(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00753">zephyr.c:753</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac292f396289364d78037cae452f1aefc"><div class="ttname"><a href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a></div><div class="ttdeci">int waitingAck</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00098">zephyr.h:98</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5">IM</a></div><div class="ttdoc">Instrument Mode (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00136">zephyr.h:136</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_ade6c9212e8175f2f26cb4ffa27f6f71c"><div class="ttname"><a href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a></div><div class="ttdeci">int TCflag</div><div class="ttdoc">Flag TC data transfer. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00109">zephyr.h:109</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9ad65e907dc15f9fd37da381332b2f1f"><div class="ttname"><a href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a></div><div class="ttdeci">int dataTm</div><div class="ttdoc">Indicates whether the last TM message sent contains offload data. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00108">zephyr.h:108</a></div></div>
<div class="ttc" id="zephyr_8c_html_a24fd4d56749147dbdfbb5817276010a8"><div class="ttname"><a href="zephyr_8c.html#a24fd4d56749147dbdfbb5817276010a8">HandleTC</a></div><div class="ttdeci">int HandleTC(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00688">zephyr.c:688</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2">SW</a></div><div class="ttdoc">Shutdown Warning (sent from Zehpyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00140">zephyr.h:140</a></div></div>
<div class="ttc" id="zephyr_8c_html_ac5b4e6f9b660a68301b5cd686040e61a"><div class="ttname"><a href="zephyr_8c.html#ac5b4e6f9b660a68301b5cd686040e61a">HandleSAck</a></div><div class="ttdeci">int HandleSAck(char *msgdata)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00638">zephyr.c:638</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9de05a1c8882446cef651d95cb8c03f8"><div class="ttname"><a href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a></div><div class="ttdeci">char TCfileOffload[100]</div><div class="ttdoc">Stores the name of the TC file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00095">zephyr.h:95</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43">SAck</a></div><div class="ttdoc">Safety Acknowledge (sent from Zehpyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00139">zephyr.h:139</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df">TMAck</a></div><div class="ttdoc">Telemetry Message Acknowlege (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00144">zephyr.h:144</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a4420395a38828d6be4aae8646268d258_cgraph.png" border="0" usemap="#zephyr_8c_a4420395a38828d6be4aae8646268d258_cgraph" alt=""/></div>
<map name="zephyr_8c_a4420395a38828d6be4aae8646268d258_cgraph" id="zephyr_8c_a4420395a38828d6be4aae8646268d258_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a4420395a38828d6be4aae8646268d258_icgraph.png" border="0" usemap="#zephyr_8c_a4420395a38828d6be4aae8646268d258_icgraph" alt=""/></div>
<map name="zephyr_8c_a4420395a38828d6be4aae8646268d258_icgraph" id="zephyr_8c_a4420395a38828d6be4aae8646268d258_icgraph">
</map>
</div>

</div>
</div>
<a id="a224d36d32fdd9a46fced3ac36c639169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a224d36d32fdd9a46fced3ac36c639169">&#9670;&nbsp;</a></span>MsgType()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a> MsgType </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>typestr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>&lt; Got an IM message</p>
<p>&lt; Got an SAck message</p>
<p>&lt; Got an SW message</p>
<p>&lt; Got a TMAck message</p>
<p>&lt; Got a TC message</p>
<p>&lt; Got a GPS message </p>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01889">1889</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8h_source.html#l00148">Error</a>, <a class="el" href="zephyr_8h_source.html#l00147">GPS</a>, <a class="el" href="zephyr_8h_source.html#l00136">IM</a>, <a class="el" href="zephyr_8h_source.html#l00139">SAck</a>, <a class="el" href="zephyr_8h_source.html#l00140">SW</a>, <a class="el" href="zephyr_8h_source.html#l00145">TC</a>, and <a class="el" href="zephyr_8h_source.html#l00144">TMAck</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;{</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;IM&quot;</span>, 2)==0)    </div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    {</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5">IM</a>);</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    }</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;SAck&quot;</span>, 4)==0) </div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43">SAck</a>);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    }</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;SW&quot;</span>, 2)==0)   </div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    {</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2">SW</a>);</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    }</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;TMAck&quot;</span>, 5)==0)    </div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    {</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df">TMAck</a>);</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    }</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;TC&quot;</span>, 2)==0)   </div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    {</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840">TC</a>);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strncmp(typestr, <span class="stringliteral">&quot;GPS&quot;</span>, 3)==0)  </div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    {</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182">GPS</a>);</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    }</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    {</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea4dfd42ec49d09d8c6555c218301cc30f">Error</a>);</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    }</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eae179015c05e581c38074e893dbf27840">TC</a></div><div class="ttdoc">Telecommand (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00145">zephyr.h:145</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea171ede81b49deebf3e342cdf41c62182">GPS</a></div><div class="ttdoc">GPS Data (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00147">zephyr.h:147</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea162f8ad933bb692377c68dae033e50a5">IM</a></div><div class="ttdoc">Instrument Mode (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00136">zephyr.h:136</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea247b880fc48dc1c74961ba58ae0f68a2">SW</a></div><div class="ttdoc">Shutdown Warning (sent from Zehpyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00140">zephyr.h:140</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea4dfd42ec49d09d8c6555c218301cc30f"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea4dfd42ec49d09d8c6555c218301cc30f">Error</a></div><div class="ttdoc">Unrecognized message. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00148">zephyr.h:148</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea9379400f962d840155ba4d20e8a05f43">SAck</a></div><div class="ttdoc">Safety Acknowledge (sent from Zehpyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00139">zephyr.h:139</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea24ef62bfe96b185bf5737652c028b4df">TMAck</a></div><div class="ttdoc">Telemetry Message Acknowlege (sent from Zephyr to ROC) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00144">zephyr.h:144</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a224d36d32fdd9a46fced3ac36c639169_icgraph.png" border="0" usemap="#zephyr_8c_a224d36d32fdd9a46fced3ac36c639169_icgraph" alt=""/></div>
<map name="zephyr_8c_a224d36d32fdd9a46fced3ac36c639169_icgraph" id="zephyr_8c_a224d36d32fdd9a46fced3ac36c639169_icgraph">
</map>
</div>

</div>
</div>
<a id="a5366f78d45883b7ad5934d6910efa6c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5366f78d45883b7ad5934d6910efa6c5">&#9670;&nbsp;</a></span>NewFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NewFile </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01517">1517</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8c_source.html#l01019">CloseLogFile()</a>, <a class="el" href="roc2_8c_source.html#l01067">CopyFile()</a>, <a class="el" href="roc2_8h_source.html#l00084">curfilename</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, and <a class="el" href="roc2_8c_source.html#l00977">OpenLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;{</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <a class="code" href="zephyr_8c.html#a84b0f0a6d9c4b56b743eb5b171f3172c">CloseLogFile</a>();</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <a class="code" href="zephyr_8c.html#af8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a>(<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;}</div><div class="ttc" id="zephyr_8c_html_af8b73dc85a9b8da6978eac659ec8531b"><div class="ttname"><a href="zephyr_8c.html#af8b73dc85a9b8da6978eac659ec8531b">OpenLogFile</a></div><div class="ttdeci">int OpenLogFile(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01460">zephyr.c:1460</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8c_html_a84b0f0a6d9c4b56b743eb5b171f3172c"><div class="ttname"><a href="zephyr_8c.html#a84b0f0a6d9c4b56b743eb5b171f3172c">CloseLogFile</a></div><div class="ttdeci">int CloseLogFile(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01496">zephyr.c:1496</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a5366f78d45883b7ad5934d6910efa6c5_cgraph.png" border="0" usemap="#zephyr_8c_a5366f78d45883b7ad5934d6910efa6c5_cgraph" alt=""/></div>
<map name="zephyr_8c_a5366f78d45883b7ad5934d6910efa6c5_cgraph" id="zephyr_8c_a5366f78d45883b7ad5934d6910efa6c5_cgraph">
</map>
</div>

</div>
</div>
<a id="af8b73dc85a9b8da6978eac659ec8531b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8b73dc85a9b8da6978eac659ec8531b">&#9670;&nbsp;</a></span>OpenLogFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OpenLogFile </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01460">1460</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00057">BCFILEERROR</a>, <a class="el" href="roc2_8h_source.html#l00038">BCFILEOPENERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8c_source.html#l00934">CreateDayDirectory()</a>, <a class="el" href="roc2_8h_source.html#l00084">curfilename</a>, <a class="el" href="roc2_8h_source.html#l00081">fp</a>, <a class="el" href="roc2_8c_source.html#l01134">GetGpsReply()</a>, <a class="el" href="roc2_8c_source.html#l00949">LogFileName()</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8c_source.html#l01084">SendGpsCmd()</a>, <a class="el" href="roc2_8c_source.html#l00907">TodaysDirectoryExists()</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01517">NewFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;{</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordtype">int</span> i, index, ret;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordtype">char</span> *strName;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="zephyr_8c.html#a88fb6383c5c934e876be013729f8ab60">TodaysDirectoryExists</a>())</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    {</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a>()) <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    ret = <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span>((strName = <a class="code" href="zephyr_8c.html#a45786db9b46a6cc20e64bd0a851655bc">LogFileName</a>(name)) == NULL)</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Error generating log file name.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a> = fopen(strName, <span class="stringliteral">&quot;a+&quot;</span>)) == NULL)</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Error Opening log file %s.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, strName);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        ret = <a class="code" href="roc2_8h.html#a3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a>;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    }</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) </div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            printf(<span class="stringliteral">&quot;%s: Opened log file %s.\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, strName);</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            fflush(stdout);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">return</span>(ret);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;}</div><div class="ttc" id="zephyr_8c_html_a45786db9b46a6cc20e64bd0a851655bc"><div class="ttname"><a href="zephyr_8c.html#a45786db9b46a6cc20e64bd0a851655bc">LogFileName</a></div><div class="ttdeci">char * LogFileName(char *name)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01425">zephyr.c:1425</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_abc2e895a6ef8c5a51ce9b7358e596f1b"><div class="ttname"><a href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a></div><div class="ttdeci">#define BCFILEERROR</div><div class="ttdoc">General file error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00057">roc2.h:57</a></div></div>
<div class="ttc" id="zephyr_8c_html_a88fb6383c5c934e876be013729f8ab60"><div class="ttname"><a href="zephyr_8c.html#a88fb6383c5c934e876be013729f8ab60">TodaysDirectoryExists</a></div><div class="ttdeci">int TodaysDirectoryExists(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01383">zephyr.c:1383</a></div></div>
<div class="ttc" id="roc2_8h_html_aa065f30aa9f5f9a42132c82c787ee70b"><div class="ttname"><a href="roc2_8h.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a></div><div class="ttdeci">FILE * fp</div><div class="ttdoc">Pointer to open data file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00081">roc2.h:81</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="roc2_8h_html_a3cd32c0121e7225577c4bc3c456c9771"><div class="ttname"><a href="roc2_8h.html#a3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a></div><div class="ttdeci">#define BCFILEOPENERROR</div><div class="ttdoc">Indicates error opening data file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00038">roc2.h:38</a></div></div>
<div class="ttc" id="zephyr_8c_html_a0eaf55c523b081609cd85dd6eb04682b"><div class="ttname"><a href="zephyr_8c.html#a0eaf55c523b081609cd85dd6eb04682b">CreateDayDirectory</a></div><div class="ttdeci">int CreateDayDirectory(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01410">zephyr.c:1410</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_cgraph.png" border="0" usemap="#zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_cgraph" alt=""/></div>
<map name="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_cgraph" id="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_icgraph.png" border="0" usemap="#zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_icgraph" alt=""/></div>
<map name="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_icgraph" id="zephyr_8c_af8b73dc85a9b8da6978eac659ec8531b_icgraph">
</map>
</div>

</div>
</div>
<a id="abf9cb423a606dc4f8232d1b3394042d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf9cb423a606dc4f8232d1b3394042d5">&#9670;&nbsp;</a></span>RemoveFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int RemoveFile </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01735">1735</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, and <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>, and <a class="el" href="zephyr_8c_source.html#l00514">MsgHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;{</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">if</span> (strstr(name,<span class="stringliteral">&quot;list.txt&quot;</span>)) {  </div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>=0;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>=0;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>=0;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>=0;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    }</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">return</span>(<span class="keyword">remove</span>(name));</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_abf9cb423a606dc4f8232d1b3394042d5_icgraph.png" border="0" usemap="#zephyr_8c_abf9cb423a606dc4f8232d1b3394042d5_icgraph" alt=""/></div>
<map name="zephyr_8c_abf9cb423a606dc4f8232d1b3394042d5_icgraph" id="zephyr_8c_abf9cb423a606dc4f8232d1b3394042d5_icgraph">
</map>
</div>

</div>
</div>
<a id="a184ae444081beacfe0bd5b712d378b59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a184ae444081beacfe0bd5b712d378b59">&#9670;&nbsp;</a></span>SendFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SendFile </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01598">1598</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00057">BCFILEERROR</a>, <a class="el" href="zephyr_8h_source.html#l00108">dataTm</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="zephyr_8h_source.html#l00016">MAX_DATA</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>, <a class="el" href="zephyr_8h_source.html#l00143">TM</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00038">WAITFORACK</a>, and <a class="el" href="zephyr_8h_source.html#l00098">waitingAck</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;{</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordtype">char</span> *buf;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordtype">int</span> err, n;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    FILE *ptr;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    err=stat(name, &amp;st);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Opening file %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name);</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    ptr = fopen(name, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span>(ptr==NULL)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    {</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;%s: Error getting file size\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>&gt;<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>)                       <span class="comment">// In the middle of a file transfer</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    {</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Continuing offload of %s %d/%d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name, <a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>+1, <a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>);</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        buf=malloc(<a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        }</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        fseek(ptr, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>*<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>, SEEK_SET);    <span class="comment">// move to proper place in the data file</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        n = fread(buf, 1, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>, ptr);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, n);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    }</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keywordflow">else</span>                                        <span class="comment">// Starting new transfer</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        <a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a> = (st.st_size / <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>) + 1;     <span class="comment">// calculate how many parts the file needs to be broken into</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: size = %d parts = %d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,st.st_size,<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>&gt;1)                              <span class="comment">// multipart file</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Starting offload of %s 1/%d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name, <a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            buf=malloc(<a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            n = fread(buf, 1, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>, ptr);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, n);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        }</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        {                                           <span class="comment">// single part file</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s:  Offloading %s 1/1\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            buf=malloc(st.st_size);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            n = fread(buf, 1, st.st_size, ptr);</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, st.st_size);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">//          write(zephyr.fp, buf, n);</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    }</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=<a class="code" href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a>;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">//  ackTimeout=time(NULL) + 5;</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    fclose(ptr);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordflow">if</span> (buf) free(buf);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a></div><div class="ttdoc">Telemetry Message (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00143">zephyr.h:143</a></div></div>
<div class="ttc" id="zephyr_8h_html_aaf06a3762adb0aa04b8a5f8f016ca5e9"><div class="ttname"><a href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a></div><div class="ttdeci">#define MAX_DATA</div><div class="ttdoc">Maximum size of TM packet payload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00016">zephyr.h:16</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac292f396289364d78037cae452f1aefc"><div class="ttname"><a href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a></div><div class="ttdeci">int waitingAck</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00098">zephyr.h:98</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9ad65e907dc15f9fd37da381332b2f1f"><div class="ttname"><a href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a></div><div class="ttdeci">int dataTm</div><div class="ttdoc">Indicates whether the last TM message sent contains offload data. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00108">zephyr.h:108</a></div></div>
<div class="ttc" id="roc2_8h_html_abc2e895a6ef8c5a51ce9b7358e596f1b"><div class="ttname"><a href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a></div><div class="ttdeci">#define BCFILEERROR</div><div class="ttdoc">General file error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00057">roc2.h:57</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6e021f179fc712de402af1043ca1a9ef"><div class="ttname"><a href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a></div><div class="ttdeci">void SendMsg(enum msg msgtype, char *payload, int payload_size)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01748">zephyr.c:1748</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7f970a76fd7cbf3dd6143df7262bbccc"><div class="ttname"><a href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a></div><div class="ttdeci">#define WAITFORACK</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00038">zephyr.h:38</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_cgraph.png" border="0" usemap="#zephyr_8c_a184ae444081beacfe0bd5b712d378b59_cgraph" alt=""/></div>
<map name="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_cgraph" id="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_icgraph.png" border="0" usemap="#zephyr_8c_a184ae444081beacfe0bd5b712d378b59_icgraph" alt=""/></div>
<map name="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_icgraph" id="zephyr_8c_a184ae444081beacfe0bd5b712d378b59_icgraph">
</map>
</div>

</div>
</div>
<a id="a6e021f179fc712de402af1043ca1a9ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e021f179fc712de402af1043ca1a9ef">&#9670;&nbsp;</a></span>SendMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SendMsg </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3e">msg</a>&#160;</td>
          <td class="paramname"><em>msgtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>payload_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>&lt; Tells Zephyr we're done booting and ready for mode change</p>
<p>&lt; Tells Zephyr we got the mode change command</p>
<p>&lt; always sending ACK for now, change later</p>
<p>&lt; Tells Zephyr we're in Safety mode now, ok to shut off power</p>
<p>&lt; Telemetry message. This is how we send data to Zephyr</p>
<p>&lt; Tells Zephyr we got the telecommand message (uplink data)</p>
<p>&lt; always sending ACK for now, change later </p>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01748">1748</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="zephyr_8c_source.html#l01875">ComputeCRC()</a>, <a class="el" href="zephyr_8h_source.html#l00156">crc_calc</a>, <a class="el" href="zephyr_8h_source.html#l00108">dataTm</a>, <a class="el" href="zephyr_8h_source.html#l00094">fileOffload</a>, <a class="el" href="roc2_8h_source.html#l00096">serial::fp</a>, <a class="el" href="zephyr_8h_source.html#l00137">IMAck</a>, <a class="el" href="zephyr_8h_source.html#l00135">IMR</a>, <a class="el" href="zephyr_8h_source.html#l00012">INSTID</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00155">MsgID</a>, <a class="el" href="zephyr_8h_source.html#l00106">nextMsgTime</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="zephyr_8h_source.html#l00153">outBuf</a>, <a class="el" href="zephyr_8h_source.html#l00138">S</a>, <a class="el" href="roc2_8h_source.html#l00010">SWDate</a>, <a class="el" href="roc2_8h_source.html#l00011">SWVersion</a>, <a class="el" href="zephyr_8h_source.html#l00146">TCAck</a>, <a class="el" href="zephyr_8h_source.html#l00095">TCfileOffload</a>, <a class="el" href="zephyr_8h_source.html#l00109">TCflag</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>, <a class="el" href="zephyr_8h_source.html#l00143">TM</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00015">ZephVersion</a>, and <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00570">HandleIM()</a>, <a class="el" href="zephyr_8c_source.html#l00688">HandleTC()</a>, <a class="el" href="zephyr_8c_source.html#l00042">main()</a>, <a class="el" href="zephyr_8c_source.html#l01598">SendFile()</a>, and <a class="el" href="zephyr_8c_source.html#l01666">TCSendFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;{</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cs;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordtype">int</span> ptr;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keyword">struct </span>timespec curTime;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">char</span> hdr_msg[128];</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordtype">size_t</span>  wrote;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    </div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    clock_gettime(CLOCK_REALTIME, &amp;curTime);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">while</span>((curTime.tv_sec &lt; <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_sec) || ((curTime.tv_sec == <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_sec) &amp;&amp; (curTime.tv_nsec &lt; <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec))) <span class="comment">// Wait until it&#39;s ok to send next msg</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    {</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        clock_gettime(CLOCK_REALTIME, &amp;curTime);</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        usleep(50000);      <span class="comment">// sleep for 50ms</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Sending message at time %ld.%03ld\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, curTime.tv_sec, curTime.tv_nsec/1000000);</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">switch</span>(msgtype)</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a>:           </div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,<span class="stringliteral">&quot;&lt;IMR&gt;\n\t&lt;Msg&gt;%d&lt;/Msg&gt;\n\t&lt;Inst&gt;%s&lt;/Inst&gt;\n\t&lt;SWDate&gt;%s&lt;/SWDate&gt;\n\t&lt;SWVersion&gt;%s&lt;/SWVersion&gt;\n\t&lt;ZProtocolVersion&gt;%s&lt;/ZProtocolVersion&gt;\n&lt;/IMR&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>,<a class="code" href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a>,<a class="code" href="roc2_8h.html#a8e5d9993745ca60b1777be3b1fa57a53">SWDate</a>,<a class="code" href="roc2_8h.html#ad6f212287232c8a7d12dbc0e5901635d">SWVersion</a>,<a class="code" href="zephyr_8h.html#ad70863efc178e87c7ea48699a141771b">ZephVersion</a>);</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>=<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;&lt;CRC&gt;%d&lt;/CRC&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>);</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            write(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>, strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70">IMAck</a>:         </div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,<span class="stringliteral">&quot;&lt;IMAck&gt;\n\t&lt;Msg&gt;%d&lt;/Msg&gt;\n\t&lt;Inst&gt;%s&lt;/Inst&gt;\n\t&lt;Ack&gt;%s&lt;/Ack&gt;\n&lt;/IMAck&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>,<a class="code" href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a>,<span class="stringliteral">&quot;ACK&quot;</span>);      </div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            <a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>=<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;&lt;CRC&gt;%d&lt;/CRC&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>);</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            write(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>, strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670">S</a>:             </div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,<span class="stringliteral">&quot;&lt;S&gt;\n\t&lt;Msg&gt;%d&lt;/Msg&gt;\n\t&lt;Inst&gt;%s&lt;/Inst&gt;\n&lt;/S&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>,<a class="code" href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a>);     </div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            <a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>=<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;&lt;CRC&gt;%d&lt;/CRC&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            write(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>, strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>:            </div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a>) {</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                sprintf(hdr_msg, <span class="stringliteral">&quot;%s,%d,%d&quot;</span>,<a class="code" href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a>,<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>,<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            }</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a>)     <span class="comment">// This message contains a data payload</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            {</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                sprintf(hdr_msg, <span class="stringliteral">&quot;%s,%d,%d&quot;</span>,<a class="code" href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a>,<a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a>,<a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a>);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            }</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <span class="keywordflow">else</span>            <span class="comment">// This is just a housekeeping message, no data payload</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            {</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                sprintf(hdr_msg,<span class="stringliteral">&quot;000&quot;</span>);     <span class="comment">// This should eventually contain # satellites tracked</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            }</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,<span class="stringliteral">&quot;&lt;TM&gt;\n\t&lt;Msg&gt;%d&lt;/Msg&gt;\n\t&lt;Inst&gt;%s&lt;/Inst&gt;\n\t&lt;StateFlag1&gt;FINE&lt;/StateFlag1&gt;\n\t&lt;StateMess1&gt;%s&lt;/StateMess1&gt;\n\t&lt;Length&gt;%d&lt;/Length&gt;\n&lt;/TM&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>,<a class="code" href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a>,hdr_msg,payload_size);</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            <a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>=<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;&lt;CRC&gt;%d&lt;/CRC&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>);</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;START&quot;</span>);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s:Payload %d bytes:&quot;</span>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>, payload_size);</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            ptr=strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>);</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            memcpy(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+ptr,payload,payload_size);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            ptr+=payload_size;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            cs = <a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(payload,payload_size);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            byte = ((cs &amp; 0xFF00) &gt;&gt; 8) &amp; 0xFF;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%02X&quot;</span>, byte);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            memcpy(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+ptr, &amp;byte, 1);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            ptr++;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            byte = cs &amp; 0xFF;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%02X&quot;</span>, byte);</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            memcpy(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+ptr, &amp;byte, 1);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            ptr++;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+ptr,<span class="stringliteral">&quot;END&quot;</span>);</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            ptr+=3;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;:END\n&quot;</span>);</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            wrote=0;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">//          printf(&quot;data to write = %d\r\n&quot;, ptr);</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;            <span class="keywordflow">while</span>(ptr &gt; 0)</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            {</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                wrote = write(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+wrote, ptr);</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                ptr -= wrote;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">//              printf(&quot;wrote = %d  ptr = %d\r\n&quot;, wrote, ptr);</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">//              usleep(300000);     // sleep for 300ms</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            }</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98">TCAck</a>:         </div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,<span class="stringliteral">&quot;&lt;TCAck&gt;\n\t&lt;Msg&gt;%d&lt;/Msg&gt;\n\t&lt;Inst&gt;%s&lt;/Inst&gt;\n\t&lt;Ack&gt;%s&lt;/Ack&gt;\n&lt;/TCAck&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>,<a class="code" href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a>,<span class="stringliteral">&quot;ACK&quot;</span>);      </div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;            <a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>=<a class="code" href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a>(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>,strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;            sprintf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>+strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>),<span class="stringliteral">&quot;&lt;CRC&gt;%d&lt;/CRC&gt;\n&quot;</span>,<a class="code" href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a>);</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>);</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;            write(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, <a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>, strlen(<a class="code" href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a>));</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    }</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    </div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a>++;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">//  nextMsgTime = curTime;  // set earliest time for sending</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    clock_gettime(CLOCK_REALTIME, &amp;<a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>);    <span class="comment">// set earliest time for sending</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">if</span> (msgtype != <a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>) {</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec += 300000000;                   <span class="comment">// next message (300 msec from now)</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec &gt; 1000000000) {</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_nsec -= 1000000000;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;            <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_sec += 1;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    } <span class="keywordflow">else</span>  <a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>.tv_sec += 1;                        <span class="comment">// next message (1 sec from now)</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_afe4816e53e5d7a1264d7b0eec60b7eb9"><div class="ttname"><a href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a></div><div class="ttdeci">struct timespec nextMsgTime</div><div class="ttdoc">Earliest time that is OK to send the next message (no more than once/sec) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00106">zephyr.h:106</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a39c375768ddcc0625a1557e78d08c6e8"><div class="ttname"><a href="zephyr_8h.html#a39c375768ddcc0625a1557e78d08c6e8">INSTID</a></div><div class="ttdeci">#define INSTID</div><div class="ttdoc">Instrument ID string in message headers. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00012">zephyr.h:12</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eaf1ce01387d2348f8b858721a7db81670">S</a></div><div class="ttdoc">Safety mode reached (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00138">zephyr.h:138</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad9de7f17717cd6e46d8f5f4e869a4bd1"><div class="ttname"><a href="zephyr_8h.html#ad9de7f17717cd6e46d8f5f4e869a4bd1">fileOffload</a></div><div class="ttdeci">char fileOffload[100]</div><div class="ttdoc">Stores the name of the file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00094">zephyr.h:94</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a></div><div class="ttdoc">Telemetry Message (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00143">zephyr.h:143</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad70863efc178e87c7ea48699a141771b"><div class="ttname"><a href="zephyr_8h.html#ad70863efc178e87c7ea48699a141771b">ZephVersion</a></div><div class="ttdeci">#define ZephVersion</div><div class="ttdoc">Zephyr protocol version. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00015">zephyr.h:15</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7f6a37befbb900cb0a526b9a5c349c70">IMAck</a></div><div class="ttdoc">Instrument Mode Acknowledge (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00137">zephyr.h:137</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="structserial_html_a5794fd6ed295d17d7c80293f11f41b6b"><div class="ttname"><a href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">serial::fp</a></div><div class="ttdeci">int fp</div><div class="ttdoc">File descriptor for open serial port. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00096">roc2.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_ade6c9212e8175f2f26cb4ffa27f6f71c"><div class="ttname"><a href="zephyr_8h.html#ade6c9212e8175f2f26cb4ffa27f6f71c">TCflag</a></div><div class="ttdeci">int TCflag</div><div class="ttdoc">Flag TC data transfer. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00109">zephyr.h:109</a></div></div>
<div class="ttc" id="roc2_8h_html_a8e5d9993745ca60b1777be3b1fa57a53"><div class="ttname"><a href="roc2_8h.html#a8e5d9993745ca60b1777be3b1fa57a53">SWDate</a></div><div class="ttdeci">#define SWDate</div><div class="ttdoc">Build date and time. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00010">roc2.h:10</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9ad65e907dc15f9fd37da381332b2f1f"><div class="ttname"><a href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a></div><div class="ttdeci">int dataTm</div><div class="ttdoc">Indicates whether the last TM message sent contains offload data. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00108">zephyr.h:108</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="zephyr_8h_html_a0ec421eee79cdd961d241dd324a226fa"><div class="ttname"><a href="zephyr_8h.html#a0ec421eee79cdd961d241dd324a226fa">crc_calc</a></div><div class="ttdeci">unsigned short crc_calc</div><div class="ttdoc">Calculated CRC value. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00156">zephyr.h:156</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7c1d11a9bbf54a9ff9af0ad29823bd73">IMR</a></div><div class="ttdoc">Instrument Mode Request (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00135">zephyr.h:135</a></div></div>
<div class="ttc" id="zephyr_8h_html_a8d5fb6f3fe9be9941e57854d5c3f2568"><div class="ttname"><a href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a></div><div class="ttdeci">int MsgID</div><div class="ttdoc">counter that increments with each sent message </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00155">zephyr.h:155</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_aa7865b0822633a51bd794f1922f39711"><div class="ttname"><a href="zephyr_8c.html#aa7865b0822633a51bd794f1922f39711">ComputeCRC</a></div><div class="ttdeci">unsigned short ComputeCRC(char *data, int len)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01875">zephyr.c:1875</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9de05a1c8882446cef651d95cb8c03f8"><div class="ttname"><a href="zephyr_8h.html#a9de05a1c8882446cef651d95cb8c03f8">TCfileOffload</a></div><div class="ttdeci">char TCfileOffload[100]</div><div class="ttdoc">Stores the name of the TC file being currently offloaded. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00095">zephyr.h:95</a></div></div>
<div class="ttc" id="zephyr_8h_html_a233416189a89eb6ac64b404dbeec54e4"><div class="ttname"><a href="zephyr_8h.html#a233416189a89eb6ac64b404dbeec54e4">outBuf</a></div><div class="ttdeci">char outBuf[16348]</div><div class="ttdoc">incoming and outgoing serial buffers </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00153">zephyr.h:153</a></div></div>
<div class="ttc" id="roc2_8h_html_ad6f212287232c8a7d12dbc0e5901635d"><div class="ttname"><a href="roc2_8h.html#ad6f212287232c8a7d12dbc0e5901635d">SWVersion</a></div><div class="ttdeci">#define SWVersion</div><div class="ttdoc">Software version number. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00011">roc2.h:11</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3ea7e72124ca75fccf172d7c0888e3d8e98">TCAck</a></div><div class="ttdoc">Telecommand Acknowledge (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00146">zephyr.h:146</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_cgraph.png" border="0" usemap="#zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_cgraph" alt=""/></div>
<map name="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_cgraph" id="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_icgraph.png" border="0" usemap="#zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_icgraph" alt=""/></div>
<map name="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_icgraph" id="zephyr_8c_a6e021f179fc712de402af1043ca1a9ef_icgraph">
</map>
</div>

</div>
</div>
<a id="a919ac26442368faff61c89f0f62fd58b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a919ac26442368faff61c89f0f62fd58b">&#9670;&nbsp;</a></span>SerialPortInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SerialPortInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structserial.html">serial</a>&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01180">1180</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00033">BCERROR</a>, <a class="el" href="roc2_8h_source.html#l00049">BCINVALIDBITS</a>, <a class="el" href="roc2_8h_source.html#l00053">BCINVALIDFLOW</a>, <a class="el" href="roc2_8h_source.html#l00051">BCINVALIDPAR</a>, <a class="el" href="roc2_8h_source.html#l00052">BCINVALIDSTOP</a>, <a class="el" href="roc2_8h_source.html#l00050">BCSEROPENERROR</a>, <a class="el" href="roc2_8h_source.html#l00054">BCSETATTRERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8h_source.html#l00091">serial::bits</a>, <a class="el" href="roc2_8h_source.html#l00094">serial::flow</a>, <a class="el" href="roc2_8h_source.html#l00096">serial::fp</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8h_source.html#l00092">serial::parity</a>, <a class="el" href="roc2_8h_source.html#l00089">serial::port</a>, <a class="el" href="roc2_8h_source.html#l00090">serial::speed</a>, <a class="el" href="roc2_8h_source.html#l00093">serial::stop</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;{</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keyword">struct </span>termios options;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Opening port %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, port.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    port.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a> = open(port.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>, O_RDWR | O_NOCTTY | O_NDELAY);    <span class="comment">// Open serial port</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span>(port.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a> == <a class="code" href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a>)</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a917385f51ef11c435842e3a175902f42">BCSEROPENERROR</a>);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    tcgetattr(port.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, &amp;options);                       <span class="comment">// Get current port options</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    cfsetispeed(&amp;options, port.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>);              <span class="comment">// Set input baud rate</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    cfsetospeed(&amp;options, port.<a class="code" href="structserial.html#a366233b5459782dca82c5b5c28dcd066">speed</a>);              <span class="comment">// Set output baud rate</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    options.c_cflag &amp;= ~CSIZE;                          <span class="comment">// Clear data bit fields</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">switch</span>(port.<a class="code" href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">bits</a>)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    {</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">case</span> 7:</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            options.c_cflag |= CS7;                     <span class="comment">// Select 7 data bits</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="keywordflow">case</span> 8:</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            options.c_cflag |= CS8;                     <span class="comment">// Select 8 data bits</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#ae81be3717fce090da2f1fead60cbcaee">BCINVALIDBITS</a>);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    }</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">switch</span>(port.<a class="code" href="structserial.html#a948f0bf5113570f168cd030c3a71a887">parity</a>)</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            options.c_cflag &amp;= ~PARENB;                 <span class="comment">// Clear parity enable bit</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            options.c_iflag &amp;= ~INPCK;                  <span class="comment">// Disable parity checking of incoming data</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;O&#39;</span>:</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            options.c_cflag |= PARENB;                  <span class="comment">// Set parity enable bit</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            options.c_cflag |= PARODD;                  <span class="comment">// Set odd parity bit</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            options.c_iflag |= (INPCK | ISTRIP);        <span class="comment">// Enable parity checking of incoming data</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            options.c_cflag |= PARENB;                  <span class="comment">// Set parity enable bit</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            options.c_cflag &amp;= ~PARODD;                 <span class="comment">// Clear odd parity bit (which means use even parity)</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            options.c_iflag |= (INPCK | ISTRIP);        <span class="comment">// Enable parity checking of incoming data</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a95fc7e0c0cea8fdb89d2b22411469b5e">BCINVALIDPAR</a>);</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">switch</span>(port.<a class="code" href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">stop</a>)</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            options.c_cflag &amp;= ~CSTOPB;                 <span class="comment">// Clear stop bits bit (which means use 1 stop bit)</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            <span class="keywordflow">break</span>;          </div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            options.c_cflag |= CSTOPB;                  <span class="comment">// Set stop bits bit (which means use 2 stop bits)</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            <span class="keywordflow">break</span>;          </div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#ac5ed0d3199ad199fb8af5fd13af5ed76">BCINVALIDSTOP</a>);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">switch</span>(port.<a class="code" href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">flow</a>)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            options.c_cflag &amp;= ~CRTSCTS;                <span class="comment">// Disable hardware flow control</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            options.c_iflag &amp;= ~(IXON | IXOFF | IXANY); <span class="comment">// Disable software flow control</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;H&#39;</span>:</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            options.c_cflag |= CRTSCTS;                 <span class="comment">// Enable hardware flow control</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            options.c_iflag &amp;= ~(IXON | IXOFF | IXANY); <span class="comment">// Disable software flow control</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            options.c_cflag &amp;= ~CRTSCTS;                <span class="comment">// Disable hardware flow control</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;            options.c_iflag |= (IXON | IXOFF | IXANY);  <span class="comment">// Enable software flow control</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a3cc54957cc0646a3182940f88684be4d">BCINVALIDFLOW</a>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    options.c_iflag &amp;= ~ICRNL;                          <span class="comment">// disable mapping of CR to NL</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    options.c_lflag &amp;= ~(ICANON | ECHO | ECHOE | ECHOK | ECHONL | ECHOCTL | ECHOPRT | ECHOKE | ISIG);   <span class="comment">// Turn off line read (canonical) mode and character echoes</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    options.c_cflag |= CLOCAL;                          <span class="comment">// Set local mode</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">//  options.c_cflag &amp;= ~CREAD;                          // Disable the receiver for now</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    options.c_cflag |= CREAD;                           <span class="comment">// Enable the receiver</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    options.c_oflag &amp;= ~OPOST;                          <span class="comment">// Disable all processed output settings</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    options.c_cc[VMIN] = 0;                             <span class="comment">// Forces the read() function to return immediately with however many characters are available</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    options.c_cc[VTIME] = 0;                            <span class="comment">// Tells the read() function not to wait for any data</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">if</span>(tcsetattr(port.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>, TCSANOW, &amp;options) == 0)  <span class="comment">// Make the new settings active</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">//      sleep(2);</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        tcflush(port.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>,TCIOFLUSH);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a883799ad282c86bfe883fe8861adaf21">BCSETATTRERROR</a>);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;}</div><div class="ttc" id="structserial_html_a366233b5459782dca82c5b5c28dcd066"><div class="ttname"><a href="structserial.html#a366233b5459782dca82c5b5c28dcd066">serial::speed</a></div><div class="ttdeci">int speed</div><div class="ttdoc">Serial baud rate. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00090">roc2.h:90</a></div></div>
<div class="ttc" id="structserial_html_a948f0bf5113570f168cd030c3a71a887"><div class="ttname"><a href="structserial.html#a948f0bf5113570f168cd030c3a71a887">serial::parity</a></div><div class="ttdeci">char parity</div><div class="ttdoc">Parity bit (&amp;#39;N&amp;#39;, &amp;#39;O&amp;#39;, or &amp;#39;E&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00092">roc2.h:92</a></div></div>
<div class="ttc" id="roc2_8h_html_a883799ad282c86bfe883fe8861adaf21"><div class="ttname"><a href="roc2_8h.html#a883799ad282c86bfe883fe8861adaf21">BCSETATTRERROR</a></div><div class="ttdeci">#define BCSETATTRERROR</div><div class="ttdoc">Error setting serial attributes. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00054">roc2.h:54</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a3cc54957cc0646a3182940f88684be4d"><div class="ttname"><a href="roc2_8h.html#a3cc54957cc0646a3182940f88684be4d">BCINVALIDFLOW</a></div><div class="ttdeci">#define BCINVALIDFLOW</div><div class="ttdoc">Indicates unsupported flow control specifier. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00053">roc2.h:53</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="structserial_html_a5794fd6ed295d17d7c80293f11f41b6b"><div class="ttname"><a href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">serial::fp</a></div><div class="ttdeci">int fp</div><div class="ttdoc">File descriptor for open serial port. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00096">roc2.h:96</a></div></div>
<div class="ttc" id="structserial_html_a8a92bf8709c05cdaed2f888396296c2a"><div class="ttname"><a href="structserial.html#a8a92bf8709c05cdaed2f888396296c2a">serial::bits</a></div><div class="ttdeci">int bits</div><div class="ttdoc">Bits per character (7 or 8) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00091">roc2.h:91</a></div></div>
<div class="ttc" id="roc2_8h_html_a917385f51ef11c435842e3a175902f42"><div class="ttname"><a href="roc2_8h.html#a917385f51ef11c435842e3a175902f42">BCSEROPENERROR</a></div><div class="ttdeci">#define BCSEROPENERROR</div><div class="ttdoc">Error opening serial port. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00050">roc2.h:50</a></div></div>
<div class="ttc" id="roc2_8h_html_a92d440cdd980e61a41b9238ca8d8cdc5"><div class="ttname"><a href="roc2_8h.html#a92d440cdd980e61a41b9238ca8d8cdc5">BCERROR</a></div><div class="ttdeci">#define BCERROR</div><div class="ttdoc">Indicates general error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00033">roc2.h:33</a></div></div>
<div class="ttc" id="structserial_html_a543b38efa076f4c10ccaf7b597fd70c1"><div class="ttname"><a href="structserial.html#a543b38efa076f4c10ccaf7b597fd70c1">serial::flow</a></div><div class="ttdeci">char flow</div><div class="ttdoc">Flow control (&amp;#39;N&amp;#39;, &amp;#39;H&amp;#39;, or &amp;#39;S&amp;#39;) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00094">roc2.h:94</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="structserial_html_aa580759728df3298cdd37fef46459040"><div class="ttname"><a href="structserial.html#aa580759728df3298cdd37fef46459040">serial::port</a></div><div class="ttdeci">char * port</div><div class="ttdoc">Serial device name. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00089">roc2.h:89</a></div></div>
<div class="ttc" id="roc2_8h_html_ae81be3717fce090da2f1fead60cbcaee"><div class="ttname"><a href="roc2_8h.html#ae81be3717fce090da2f1fead60cbcaee">BCINVALIDBITS</a></div><div class="ttdeci">#define BCINVALIDBITS</div><div class="ttdoc">Indicates unsupported number of serial data bits. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00049">roc2.h:49</a></div></div>
<div class="ttc" id="roc2_8h_html_a95fc7e0c0cea8fdb89d2b22411469b5e"><div class="ttname"><a href="roc2_8h.html#a95fc7e0c0cea8fdb89d2b22411469b5e">BCINVALIDPAR</a></div><div class="ttdeci">#define BCINVALIDPAR</div><div class="ttdoc">Indicates unsupported serial parity. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00051">roc2.h:51</a></div></div>
<div class="ttc" id="roc2_8h_html_ac5ed0d3199ad199fb8af5fd13af5ed76"><div class="ttname"><a href="roc2_8h.html#ac5ed0d3199ad199fb8af5fd13af5ed76">BCINVALIDSTOP</a></div><div class="ttdeci">#define BCINVALIDSTOP</div><div class="ttdoc">Indicates unsupported number of serial stop bits. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00052">roc2.h:52</a></div></div>
<div class="ttc" id="structserial_html_ad9c26f97e179a67c08b8a0253c05bb58"><div class="ttname"><a href="structserial.html#ad9c26f97e179a67c08b8a0253c05bb58">serial::stop</a></div><div class="ttdeci">int stop</div><div class="ttdoc">Number of stop bits (1 or 2) </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00093">roc2.h:93</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a919ac26442368faff61c89f0f62fd58b_icgraph.png" border="0" usemap="#zephyr_8c_a919ac26442368faff61c89f0f62fd58b_icgraph" alt=""/></div>
<map name="zephyr_8c_a919ac26442368faff61c89f0f62fd58b_icgraph" id="zephyr_8c_a919ac26442368faff61c89f0f62fd58b_icgraph">
</map>
</div>

</div>
</div>
<a id="ac266e79779ea42b506b577821d4a834d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac266e79779ea42b506b577821d4a834d">&#9670;&nbsp;</a></span>set_gpio0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_gpio0 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l02042">2042</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;{</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    </div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">if</span>(state)</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gpio0 1&quot;</span>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    }</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    {</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio gpio0 0&quot;</span>);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    system(cmdstr);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a7e696bce041fca9cc1924bcd65cbc503"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e696bce041fca9cc1924bcd65cbc503">&#9670;&nbsp;</a></span>set_safe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_safe </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01991">1991</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;{</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordtype">char</span> cmdstr[32];</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    </div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordflow">if</span>(state)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio safe 1&quot;</span>);</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        sprintf(cmdstr,<span class="stringliteral">&quot;gpio safe 0&quot;</span>);</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    }</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    system(cmdstr);</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;}</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a7e696bce041fca9cc1924bcd65cbc503_icgraph.png" border="0" usemap="#zephyr_8c_a7e696bce041fca9cc1924bcd65cbc503_icgraph" alt=""/></div>
<map name="zephyr_8c_a7e696bce041fca9cc1924bcd65cbc503_icgraph" id="zephyr_8c_a7e696bce041fca9cc1924bcd65cbc503_icgraph">
</map>
</div>

</div>
</div>
<a id="af672e15ff453fe857ab4ce7de925f34a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af672e15ff453fe857ab4ce7de925f34a">&#9670;&nbsp;</a></span>TCSendFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TCSendFile </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01666">1666</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00057">BCFILEERROR</a>, <a class="el" href="zephyr_8h_source.html#l00108">dataTm</a>, <a class="el" href="zephyr_8h_source.html#l00016">MAX_DATA</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8c_source.html#l01748">SendMsg()</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>, <a class="el" href="zephyr_8h_source.html#l00143">TM</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00038">WAITFORACK</a>, and <a class="el" href="zephyr_8h_source.html#l00098">waitingAck</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;{</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordtype">char</span> *buf;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <span class="keywordtype">int</span> err, n;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    FILE *ptr;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    err=stat(name, &amp;st);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Opening file %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    ptr = fopen(name, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <span class="keywordflow">if</span>(ptr==NULL)</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;%s: Error getting file size\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>&gt;<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>)                       <span class="comment">// In the middle of a file transfer</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    {</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Continuing offload of %s %d/%d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name, <a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>+1, <a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        buf=malloc(<a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        {</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        }</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        fseek(ptr, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>*<a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a>, SEEK_SET);  <span class="comment">// move to proper place in the data file</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        n = fread(buf, 1, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>, ptr);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, n);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keywordflow">else</span>                                        <span class="comment">// Starting new transfer</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    {</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        <a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a> = (st.st_size / <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>) + 1;       <span class="comment">// calculate how many parts the file needs to be broken into</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: size = %d parts = %d\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>,st.st_size,<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>);</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>&gt;1)                                <span class="comment">// multipart file</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        {</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Starting offload of %s 1/%d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name, <a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a>);</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            buf=malloc(<a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            {</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            }</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            n = fread(buf, 1, <a class="code" href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a>, ptr);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, n);</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        }</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        {                                           <span class="comment">// single part file</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s:  Offloading %s 1/1\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, name);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            buf=malloc(st.st_size);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            <span class="keywordflow">if</span>(buf==NULL)</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            {</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;%s: Error allocating buffer for file read\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a>);</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            }</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;            n = fread(buf, 1, st.st_size, ptr);</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            <a class="code" href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a> = 1;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            <a class="code" href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a>(<a class="code" href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a>, buf, st.st_size);</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">//          write(zephyr.fp, buf, n);</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        }</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    }</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a>=<a class="code" href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">//  ackTimeout=time(NULL) + 5;</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    fclose(ptr);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keywordflow">if</span> (buf) free(buf);</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154"><div class="ttname"><a href="zephyr_8h.html#a10a0f35066079abd150539d0d13dbf3eac0f142a65b7d596e898b5ede310ac154">TM</a></div><div class="ttdoc">Telemetry Message (sent from ROC to Zephyr) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00143">zephyr.h:143</a></div></div>
<div class="ttc" id="zephyr_8h_html_aaf06a3762adb0aa04b8a5f8f016ca5e9"><div class="ttname"><a href="zephyr_8h.html#aaf06a3762adb0aa04b8a5f8f016ca5e9">MAX_DATA</a></div><div class="ttdeci">#define MAX_DATA</div><div class="ttdoc">Maximum size of TM packet payload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00016">zephyr.h:16</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac292f396289364d78037cae452f1aefc"><div class="ttname"><a href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a></div><div class="ttdeci">int waitingAck</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00098">zephyr.h:98</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_a9ad65e907dc15f9fd37da381332b2f1f"><div class="ttname"><a href="zephyr_8h.html#a9ad65e907dc15f9fd37da381332b2f1f">dataTm</a></div><div class="ttdeci">int dataTm</div><div class="ttdoc">Indicates whether the last TM message sent contains offload data. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00108">zephyr.h:108</a></div></div>
<div class="ttc" id="roc2_8h_html_abc2e895a6ef8c5a51ce9b7358e596f1b"><div class="ttname"><a href="roc2_8h.html#abc2e895a6ef8c5a51ce9b7358e596f1b">BCFILEERROR</a></div><div class="ttdeci">#define BCFILEERROR</div><div class="ttdoc">General file error. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00057">roc2.h:57</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="zephyr_8c_html_a6e021f179fc712de402af1043ca1a9ef"><div class="ttname"><a href="zephyr_8c.html#a6e021f179fc712de402af1043ca1a9ef">SendMsg</a></div><div class="ttdeci">void SendMsg(enum msg msgtype, char *payload, int payload_size)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01748">zephyr.c:1748</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7f970a76fd7cbf3dd6143df7262bbccc"><div class="ttname"><a href="zephyr_8h.html#a7f970a76fd7cbf3dd6143df7262bbccc">WAITFORACK</a></div><div class="ttdeci">#define WAITFORACK</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00038">zephyr.h:38</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_cgraph.png" border="0" usemap="#zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_cgraph" alt=""/></div>
<map name="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_cgraph" id="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_icgraph.png" border="0" usemap="#zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_icgraph" alt=""/></div>
<map name="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_icgraph" id="zephyr_8c_af672e15ff453fe857ab4ce7de925f34a_icgraph">
</map>
</div>

</div>
</div>
<a id="a88fb6383c5c934e876be013729f8ab60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88fb6383c5c934e876be013729f8ab60">&#9670;&nbsp;</a></span>TodaysDirectoryExists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TodaysDirectoryExists </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01383">1383</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00038">BCFILEOPENERROR</a>, <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="roc2_8c_source.html#l00872">TodaysDirectoryName()</a>, <a class="el" href="roc2_8c_source.html#l00888">TodaysDirectoryPath()</a>, <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>, and <a class="el" href="roc2_8h_source.html#l00077">verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01460">OpenLogFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;{</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordtype">int</span> i, found;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    DIR *dir;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    found = <a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    dir = opendir(<a class="code" href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a>());</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span>(!dir)</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordflow">if</span>(ENOENT == errno)     <span class="comment">// Directory not found</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        {</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            found = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        <span class="keywordflow">else</span>                    <span class="comment">// Some other error occurred</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a>);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        }</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            </div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="keywordflow">if</span>(found) printf(<span class="stringliteral">&quot;%s: Found %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>());</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;%s: Did not find %s\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, <a class="code" href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>());</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordflow">return</span>(found);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;}</div><div class="ttc" id="zephyr_8c_html_a29819f4927e98849304e948f13c12574"><div class="ttname"><a href="zephyr_8c.html#a29819f4927e98849304e948f13c12574">TodaysDirectoryPath</a></div><div class="ttdeci">char * TodaysDirectoryPath(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01365">zephyr.c:1365</a></div></div>
<div class="ttc" id="zephyr_8c_html_a0bacb9e2137b9572d5f02c23de2ad813"><div class="ttname"><a href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a></div><div class="ttdeci">char * TodaysDirectoryName(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01350">zephyr.c:1350</a></div></div>
<div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="roc2_8h_html_a3cd32c0121e7225577c4bc3c456c9771"><div class="ttname"><a href="roc2_8h.html#a3cd32c0121e7225577c4bc3c456c9771">BCFILEOPENERROR</a></div><div class="ttdeci">#define BCFILEOPENERROR</div><div class="ttdoc">Indicates error opening data file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00038">roc2.h:38</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_cgraph.png" border="0" usemap="#zephyr_8c_a88fb6383c5c934e876be013729f8ab60_cgraph" alt=""/></div>
<map name="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_cgraph" id="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_icgraph.png" border="0" usemap="#zephyr_8c_a88fb6383c5c934e876be013729f8ab60_icgraph" alt=""/></div>
<map name="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_icgraph" id="zephyr_8c_a88fb6383c5c934e876be013729f8ab60_icgraph">
</map>
</div>

</div>
</div>
<a id="a0bacb9e2137b9572d5f02c23de2ad813"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bacb9e2137b9572d5f02c23de2ad813">&#9670;&nbsp;</a></span>TodaysDirectoryName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* TodaysDirectoryName </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01350">1350</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00086">now</a>, and <a class="el" href="roc2_8h_source.html#l00073">todaysDirectoryName</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01383">TodaysDirectoryExists()</a>, and <a class="el" href="zephyr_8c_source.html#l01365">TodaysDirectoryPath()</a>.</p>
<div class="fragment"><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;{</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    time_t epoch;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keyword">struct </span>tm *<a class="code" href="roc2_8h.html#a133013525fac7907e0baa31ec30f8b4b">now</a>;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keyword">struct </span>timespec ts;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keywordtype">char</span> *rootname, *fullpath;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    epoch = time(NULL);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">//  epoch = ts.tv_sec;</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    now = gmtime(&amp;epoch);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    sprintf(<a class="code" href="roc2_8h.html#acf09df540c710aea6e3e39d4c149f119">todaysDirectoryName</a>,<span class="stringliteral">&quot;%04d%02d%02d&quot;</span>, (now-&gt;tm_year)+1900, (now-&gt;tm_mon)+1, now-&gt;tm_mday);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#acf09df540c710aea6e3e39d4c149f119">todaysDirectoryName</a>);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a133013525fac7907e0baa31ec30f8b4b"><div class="ttname"><a href="roc2_8h.html#a133013525fac7907e0baa31ec30f8b4b">now</a></div><div class="ttdeci">struct timespec now</div><div class="ttdoc">Stores current time. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00086">roc2.h:86</a></div></div>
<div class="ttc" id="roc2_8h_html_acf09df540c710aea6e3e39d4c149f119"><div class="ttname"><a href="roc2_8h.html#acf09df540c710aea6e3e39d4c149f119">todaysDirectoryName</a></div><div class="ttdeci">char todaysDirectoryName[100]</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00073">roc2.h:73</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a0bacb9e2137b9572d5f02c23de2ad813_icgraph.png" border="0" usemap="#zephyr_8c_a0bacb9e2137b9572d5f02c23de2ad813_icgraph" alt=""/></div>
<map name="zephyr_8c_a0bacb9e2137b9572d5f02c23de2ad813_icgraph" id="zephyr_8c_a0bacb9e2137b9572d5f02c23de2ad813_icgraph">
</map>
</div>

</div>
</div>
<a id="a29819f4927e98849304e948f13c12574"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29819f4927e98849304e948f13c12574">&#9670;&nbsp;</a></span>TodaysDirectoryPath()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* TodaysDirectoryPath </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01365">1365</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00080">data_dir</a>, <a class="el" href="roc2_8c_source.html#l00872">TodaysDirectoryName()</a>, and <a class="el" href="roc2_8h_source.html#l00074">todaysDirectoryPath</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l01410">CreateDayDirectory()</a>, <a class="el" href="zephyr_8c_source.html#l01425">LogFileName()</a>, and <a class="el" href="zephyr_8c_source.html#l01383">TodaysDirectoryExists()</a>.</p>
<div class="fragment"><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;{</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordtype">char</span> *dirname, *fullpath;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    dirname = <a class="code" href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a>();</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    fullpath = &amp;<a class="code" href="roc2_8h.html#a17c8b16a620d8fa68aa30017abe96c50">todaysDirectoryPath</a>[0];</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    len = strlen(<a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    strcpy(fullpath, <a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    strcpy(fullpath + len, <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    strcpy(fullpath + len + 1, dirname);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    strcpy(fullpath + len + 1 + strlen(dirname), <span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    fullpath[len + strlen(dirname) + 2] = 0;    <span class="comment">// Null term</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">return</span>(fullpath);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a12878be4d584d4841c7d409b8f024644"><div class="ttname"><a href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a></div><div class="ttdeci">char * data_dir</div><div class="ttdoc">Top level directory for logged data files. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00080">roc2.h:80</a></div></div>
<div class="ttc" id="zephyr_8c_html_a0bacb9e2137b9572d5f02c23de2ad813"><div class="ttname"><a href="zephyr_8c.html#a0bacb9e2137b9572d5f02c23de2ad813">TodaysDirectoryName</a></div><div class="ttdeci">char * TodaysDirectoryName(void)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01350">zephyr.c:1350</a></div></div>
<div class="ttc" id="roc2_8h_html_a17c8b16a620d8fa68aa30017abe96c50"><div class="ttname"><a href="roc2_8h.html#a17c8b16a620d8fa68aa30017abe96c50">todaysDirectoryPath</a></div><div class="ttdeci">char todaysDirectoryPath[100]</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00074">roc2.h:74</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a29819f4927e98849304e948f13c12574_cgraph.png" border="0" usemap="#zephyr_8c_a29819f4927e98849304e948f13c12574_cgraph" alt=""/></div>
<map name="zephyr_8c_a29819f4927e98849304e948f13c12574_cgraph" id="zephyr_8c_a29819f4927e98849304e948f13c12574_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a29819f4927e98849304e948f13c12574_icgraph.png" border="0" usemap="#zephyr_8c_a29819f4927e98849304e948f13c12574_icgraph" alt=""/></div>
<map name="zephyr_8c_a29819f4927e98849304e948f13c12574_icgraph" id="zephyr_8c_a29819f4927e98849304e948f13c12574_icgraph">
</map>
</div>

</div>
</div>
<a id="a40185ea52d16cecaafae70740e90af29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40185ea52d16cecaafae70740e90af29">&#9670;&nbsp;</a></span>Usage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Usage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the usage summary showing valid command line options. </p>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00993">993</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00023">BAUD_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00024">BITS_DEFAULT</a>, <a class="el" href="roc2_8h_source.html#l00028">FILE_LEN_DEFAULT</a>, and <a class="el" href="roc2_8h_source.html#l00025">FLOW_DEFAULT</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00775">ZephyrInit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;{</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    printf(<span class="stringliteral">&quot;Usage:\r\n zephyr [OPTIONS]\r\n\r\n&quot;</span>);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    printf(<span class="stringliteral">&quot;Options:\r\n -b &lt;bit settings&gt;\tUse &lt;bit settings&gt; for the serial port (default = %s).\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a>);</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    printf(<span class="stringliteral">&quot; -f [N | H | S]\tSpecifies what type of flow control to use (N=None, H=Hardware, S=Software) (default=%c).\r\n&quot;</span>,<a class="code" href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a>);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    printf(<span class="stringliteral">&quot; -s &lt;speed&gt;\tConfigure the serial ports for &lt;speed&gt; bits per second (default = %d).\r\n&quot;</span>,<a class="code" href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a>);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">//  printf(&quot; -l &lt;length&gt;\tCreate data files of length &lt;length&gt; seconds (default = %d).\r\n&quot;,FILE_LEN_DEFAULT);</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    printf(<span class="stringliteral">&quot; -v\tVerbose mode.\r\n&quot;</span>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;}</div><div class="ttc" id="roc2_8h_html_ad9fdf5915b4e8cea83af20712b77225c"><div class="ttname"><a href="roc2_8h.html#ad9fdf5915b4e8cea83af20712b77225c">FLOW_DEFAULT</a></div><div class="ttdeci">#define FLOW_DEFAULT</div><div class="ttdoc">Default flow control setting. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00025">roc2.h:25</a></div></div>
<div class="ttc" id="roc2_8h_html_a22d8a5fa29f522516412a79347c65379"><div class="ttname"><a href="roc2_8h.html#a22d8a5fa29f522516412a79347c65379">BITS_DEFAULT</a></div><div class="ttdeci">#define BITS_DEFAULT</div><div class="ttdoc">Default serial data bits. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00024">roc2.h:24</a></div></div>
<div class="ttc" id="roc2_8h_html_a13011473aa992ebdbad6b99830b54d56"><div class="ttname"><a href="roc2_8h.html#a13011473aa992ebdbad6b99830b54d56">BAUD_DEFAULT</a></div><div class="ttdeci">#define BAUD_DEFAULT</div><div class="ttdoc">Default serial port baud rate. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00023">roc2.h:23</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a40185ea52d16cecaafae70740e90af29_icgraph.png" border="0" usemap="#zephyr_8c_a40185ea52d16cecaafae70740e90af29_icgraph" alt=""/></div>
<map name="zephyr_8c_a40185ea52d16cecaafae70740e90af29_icgraph" id="zephyr_8c_a40185ea52d16cecaafae70740e90af29_icgraph">
</map>
</div>

</div>
</div>
<a id="adab6d320323ece6f7627cb9bb04d0eb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adab6d320323ece6f7627cb9bb04d0eb9">&#9670;&nbsp;</a></span>verify_bits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int verify_bits </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>bits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01332">1332</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, and <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00903">CmdLineHandler()</a>, and <a class="el" href="zephyr_8c_source.html#l01018">LoadConfigFileSettings()</a>.</p>
<div class="fragment"><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;{</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="keywordflow">if</span>(((bits[0]==<span class="charliteral">&#39;7&#39;</span>) || (bits[0]==<span class="charliteral">&#39;8&#39;</span>)) &amp;&amp; ((toupper(bits[1])==<span class="charliteral">&#39;N&#39;</span>) || (toupper(bits[1])==<span class="charliteral">&#39;O&#39;</span>) || (toupper(bits[1])==<span class="charliteral">&#39;E&#39;</span>)) &amp;&amp; ((bits[2]==<span class="charliteral">&#39;1&#39;</span>) || (bits[2]==<span class="charliteral">&#39;2&#39;</span>)))</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;}</div><div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_adab6d320323ece6f7627cb9bb04d0eb9_icgraph.png" border="0" usemap="#zephyr_8c_adab6d320323ece6f7627cb9bb04d0eb9_icgraph" alt=""/></div>
<map name="zephyr_8c_adab6d320323ece6f7627cb9bb04d0eb9_icgraph" id="zephyr_8c_adab6d320323ece6f7627cb9bb04d0eb9_icgraph">
</map>
</div>

</div>
</div>
<a id="a10d59c21de300f9eae88f1b90ef845f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10d59c21de300f9eae88f1b90ef845f2">&#9670;&nbsp;</a></span>verify_flow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int verify_flow </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>bits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l01341">1341</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, and <a class="el" href="roc2_8h_source.html#l00014">TRUE</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00903">CmdLineHandler()</a>, and <a class="el" href="zephyr_8c_source.html#l01018">LoadConfigFileSettings()</a>.</p>
<div class="fragment"><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;{</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="keywordflow">if</span>((toupper(bits[0])==<span class="charliteral">&#39;N&#39;</span>) || (toupper(bits[0])==<span class="charliteral">&#39;H&#39;</span>) || (toupper(bits[0])==<span class="charliteral">&#39;S&#39;</span>))</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;}</div><div class="ttc" id="roc2_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="roc2_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00014">roc2.h:14</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a10d59c21de300f9eae88f1b90ef845f2_icgraph.png" border="0" usemap="#zephyr_8c_a10d59c21de300f9eae88f1b90ef845f2_icgraph" alt=""/></div>
<map name="zephyr_8c_a10d59c21de300f9eae88f1b90ef845f2_icgraph" id="zephyr_8c_a10d59c21de300f9eae88f1b90ef845f2_icgraph">
</map>
</div>

</div>
</div>
<a id="a40809263d9e34d3d93cdb0eed73db857"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40809263d9e34d3d93cdb0eed73db857">&#9670;&nbsp;</a></span>ZephyrCleanup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ZephyrCleanup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes sockets and frees memory. </p>
<p>There will be some serial port clean up stuff in here.</p>
<dl class="section return"><dt>Returns</dt><dd>Always returns BCSUCCESS </dd></dl>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00883">883</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="roc2_8h_source.html#l00080">data_dir</a>, <a class="el" href="roc2_8h_source.html#l00096">serial::fp</a>, <a class="el" href="roc2_8h_source.html#l00089">serial::port</a>, <a class="el" href="zephyr_8h_source.html#l00107">shutdown</a>, and <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>) free(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#aa580759728df3298cdd37fef46459040">port</a>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>) free(<a class="code" href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a>);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    close(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>.<a class="code" href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">fp</a>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a>) system(<span class="stringliteral">&quot;shutdown now&quot;</span>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;}</div><div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="roc2_8h_html_a12878be4d584d4841c7d409b8f024644"><div class="ttname"><a href="roc2_8h.html#a12878be4d584d4841c7d409b8f024644">data_dir</a></div><div class="ttdeci">char * data_dir</div><div class="ttdoc">Top level directory for logged data files. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00080">roc2.h:80</a></div></div>
<div class="ttc" id="zephyr_8h_html_a5161d377a61befc3f8103e794d5cb582"><div class="ttname"><a href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a></div><div class="ttdeci">int shutdown</div><div class="ttdoc">Indicates whether system should shutdown after this process ends. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00107">zephyr.h:107</a></div></div>
<div class="ttc" id="structserial_html_a5794fd6ed295d17d7c80293f11f41b6b"><div class="ttname"><a href="structserial.html#a5794fd6ed295d17d7c80293f11f41b6b">serial::fp</a></div><div class="ttdeci">int fp</div><div class="ttdoc">File descriptor for open serial port. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00096">roc2.h:96</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="structserial_html_aa580759728df3298cdd37fef46459040"><div class="ttname"><a href="structserial.html#aa580759728df3298cdd37fef46459040">serial::port</a></div><div class="ttdeci">char * port</div><div class="ttdoc">Serial device name. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00089">roc2.h:89</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a40809263d9e34d3d93cdb0eed73db857_icgraph.png" border="0" usemap="#zephyr_8c_a40809263d9e34d3d93cdb0eed73db857_icgraph" alt=""/></div>
<map name="zephyr_8c_a40809263d9e34d3d93cdb0eed73db857_icgraph" id="zephyr_8c_a40809263d9e34d3d93cdb0eed73db857_icgraph">
</map>
</div>

</div>
</div>
<a id="a26a5cd9326852a6f3a89225c8642479b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26a5cd9326852a6f3a89225c8642479b">&#9670;&nbsp;</a></span>ZephyrInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ZephyrInit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs module initialization. </p>
<p>Calls <a class="el" href="zephyr_8c.html#a8ed0e63e6cf78544f92b023037e3e7b8" title="Reads the program configuration file. ">LoadConfigFileSettings()</a> to load the configuration file settings for this module and calls <a class="el" href="zephyr_8c.html#a5dbf303fd2c465b1e724a247623fdbd2" title="Parses command line arguments. ">CmdLineHandler()</a> to handle any command line options. Finally configures a ZMQ REP socket to listen for messages from other modules.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>Number of command line arguments passed to <a class="el" href="zephyr_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>. </td></tr>
    <tr><td class="paramname">argv[]</td><td>List of command line arguments passed to <a class="el" href="zephyr_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>BCSUCCESS if successful.</li>
<li>BCCONFIGREADERROR indicates an error in <a class="el" href="zephyr_8c.html#a8ed0e63e6cf78544f92b023037e3e7b8" title="Reads the program configuration file. ">LoadConfigFileSettings()</a>.</li>
<li>BCCMDLINEERROR indicates an error in <a class="el" href="zephyr_8c.html#a5dbf303fd2c465b1e724a247623fdbd2" title="Parses command line arguments. ">CmdLineHandler()</a>.</li>
<li>BCZMQOPTERROR indicates an error setting the options of a ZMQ socket.</li>
<li>BCMODLISTERROR indicates an error in PopulateModules().</li>
<li>BCZMQBINDERROR indicates an error binding the ZMQ REP socket. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="zephyr_8c_source.html#l00775">775</a> of file <a class="el" href="zephyr_8c_source.html">zephyr.c</a>.</p>

<p class="reference">References <a class="el" href="roc2_8h_source.html#l00037">BCCMDLINEERROR</a>, <a class="el" href="roc2_8h_source.html#l00035">BCCONFIGREADERROR</a>, <a class="el" href="roc2_8h_source.html#l00032">BCSUCCESS</a>, <a class="el" href="zephyr_8h_source.html#l00077">cfgZephyr</a>, <a class="el" href="zephyr_8c_source.html#l00903">CmdLineHandler()</a>, <a class="el" href="zephyr_8h_source.html#l00105">discardFirstFile</a>, <a class="el" href="roc2_8h_source.html#l00015">FALSE</a>, <a class="el" href="zephyr_8c_source.html#l01940">gps_power()</a>, <a class="el" href="zephyr_8h_source.html#l00111">hwversion</a>, <a class="el" href="roc2_8h_source.html#l00069">ipcPipe</a>, <a class="el" href="zephyr_8h_source.html#l00096">lastPart</a>, <a class="el" href="zephyr_8c_source.html#l01018">LoadConfigFileSettings()</a>, <a class="el" href="zephyr_8h_source.html#l00018">LOWPOWERCHECK</a>, <a class="el" href="zephyr_8h_source.html#l00102">lowPowerCheck</a>, <a class="el" href="zephyr_8h_source.html#l00103">lowPowerCheckWait</a>, <a class="el" href="zephyr_8h_source.html#l00091">modeSwitch</a>, <a class="el" href="roc2_8h_source.html#l00021">MODULE_NAME</a>, <a class="el" href="zephyr_8h_source.html#l00155">MsgID</a>, <a class="el" href="zephyr_8h_source.html#l00110">nextImr</a>, <a class="el" href="zephyr_8h_source.html#l00106">nextMsgTime</a>, <a class="el" href="zephyr_8h_source.html#l00096">numParts</a>, <a class="el" href="roc2_8h_source.html#l00016">ON</a>, <a class="el" href="zephyr_8h_source.html#l00075">pathCfgZephyr</a>, <a class="el" href="roc2_8h_source.html#l00082">pipefp</a>, <a class="el" href="zephyr_8h_source.html#l00090">poweroffgps</a>, <a class="el" href="roc2_8h_source.html#l00078">quit</a>, <a class="el" href="zephyr_8h_source.html#l00093">safeAck</a>, <a class="el" href="zephyr_8h_source.html#l00017">SAFETIMEOUT</a>, <a class="el" href="zephyr_8h_source.html#l00101">safeTimeout</a>, <a class="el" href="zephyr_8h_source.html#l00128">SB</a>, <a class="el" href="zephyr_8c_source.html#l01180">SerialPortInit()</a>, <a class="el" href="zephyr_8h_source.html#l00107">shutdown</a>, <a class="el" href="zephyr_8h_source.html#l00097">TClastPart</a>, <a class="el" href="zephyr_8h_source.html#l00097">TCnumParts</a>, <a class="el" href="zephyr_8c_source.html#l00993">Usage()</a>, <a class="el" href="roc2_8h_source.html#l00077">verbose</a>, <a class="el" href="zephyr_8h_source.html#l00098">waitingAck</a>, <a class="el" href="zephyr_8h_source.html#l00099">waitingIM</a>, <a class="el" href="zephyr_8h_source.html#l00092">wakeUpFlag</a>, and <a class="el" href="zephyr_8h_source.html#l00124">zephyr</a>.</p>

<p class="reference">Referenced by <a class="el" href="zephyr_8c_source.html#l00042">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;{</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordtype">int</span> err, port;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <a class="code" href="roc2_8h.html#a2896431d6a80cd39b3d24b40237612ee">quit</a> = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    fclose(stdin);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">// Read config file</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a8ed0e63e6cf78544f92b023037e3e7b8">LoadConfigFileSettings</a>(&amp;<a class="code" href="zephyr_8h.html#aac92057dcdbc7740fb0c9166a6002229">cfgZephyr</a>, <a class="code" href="zephyr_8h.html#aa33b085cbf737c4c0159e57eb661da0d">pathCfgZephyr</a>) != <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#acc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a>);      </div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// Parse command line options</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="zephyr_8c.html#a5dbf303fd2c465b1e724a247623fdbd2">CmdLineHandler</a>(argc, argv) != <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="zephyr_8c.html#a40185ea52d16cecaafae70740e90af29">Usage</a>();</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a2e4e582aaaf87aeeb9f5cce7b1be9794">BCCMDLINEERROR</a>);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">// Set up serial ports</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    err = <a class="code" href="zephyr_8c.html#a919ac26442368faff61c89f0f62fd58b">SerialPortInit</a>(<a class="code" href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a>);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span>(err != <a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">return</span>(err);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    </div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">// Set up data logging</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">//  CreateDayDirectory();</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">//  OpenLogFile(MODULE_NAME);</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">//  clock_gettime(CLOCK_REALTIME, &amp;now);    // use internal clock for now. Eventually get times from data blocks</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">//  nextfile.tv_sec = now.tv_sec + file_len;</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">//  nextfile.tv_nsec = now.tv_nsec;</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    </div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a> = 0;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <a class="code" href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a> = 0;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    InstMode = <a class="code" href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a> = 0;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a> = 0;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a> = 0;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a> = <a class="code" href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a> = 0;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <a class="code" href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a> = <a class="code" href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a> = 0;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <a class="code" href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a> = 0;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <a class="code" href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a> = 0;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a> = <a class="code" href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a> = <a class="code" href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a>;      <span class="comment">// Enter Safe mode if we don&#39;t hear from Zephyr in 10 minutes</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a> = <a class="code" href="zephyr_8h.html#a052dadad9560c0874f9dfeedae0ccb3b">LOWPOWERCHECK</a>;  <span class="comment">// Time Interval to check for low power state</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <a class="code" href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a> = 5;          <span class="comment">// wait an extra cycle before checking</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <a class="code" href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a> = 0;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    clock_gettime(CLOCK_REALTIME, &amp;<a class="code" href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a>);    <span class="comment">// OK to send msg at any time</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a> = time(NULL)+5;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// Set up named pipe</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    printf(<span class="stringliteral">&quot;%s: mkfifo returned %d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, mkfifo(<a class="code" href="roc2_8h.html#ad68a72f177ed1f87cf7cc8325069d9a0">ipcPipe</a>, 0666));</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="roc2_8h.html#a576d1db2a3cf8ffa97ba33bbb1420592">pipefp</a> = fopen(<a class="code" href="roc2_8h.html#ad68a72f177ed1f87cf7cc8325069d9a0">ipcPipe</a>, <span class="stringliteral">&quot;r+&quot;</span>);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a576d1db2a3cf8ffa97ba33bbb1420592">pipefp</a>)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Opened named pipe successfully\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;%s: Attempt to open named pipe returned %d\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>, errno);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    </div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a>)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a>(<a class="code" href="roc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a>);  <span class="comment">// Note: this also turns on power to LED&#39;s</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set Safe Export\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;193\&quot; &gt; /sys/class/gpio/export&quot;</span>);                <span class="comment">// Prepare SAFE digital output</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set Safe Direction\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;out\&quot; &gt; /sys/class/gpio/gpio193/direction&quot;</span>);     <span class="comment">// Set as output</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set Safe Low\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;0\&quot;   &gt; /sys/class/gpio/gpio193/value&quot;</span>);         <span class="comment">// Set value to low</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    </div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set nRST Export\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;200\&quot; &gt; /sys/class/gpio/export&quot;</span>);                <span class="comment">// Prepare SAFE digital output</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set nRST Direction\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;out\&quot; &gt; /sys/class/gpio/gpio200/direction&quot;</span>);     <span class="comment">// Set as output</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set nRST Low\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio200/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set TogglePwr Export\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;202\&quot; &gt; /sys/class/gpio/export&quot;</span>);                <span class="comment">// Prepare SAFE digital output</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set nRST Direction\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;out\&quot; &gt; /sys/class/gpio/gpio202/direction&quot;</span>);     <span class="comment">// Set as output</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set nRST Low\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio202/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set 5VPwr Export\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;233\&quot; &gt; /sys/class/gpio/export&quot;</span>);                <span class="comment">// Prepare SAFE digital output</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set 5VPwr Direction\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;out\&quot; &gt; /sys/class/gpio/gpio233/direction&quot;</span>);     <span class="comment">// Set as output</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;%s: Init: Set 5VPwr High(on)\r\n&quot;</span>, <a class="code" href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            system(<span class="stringliteral">&quot;echo \&quot;1\&quot;   &gt; /sys/class/gpio/gpio233/value&quot;</span>);         <span class="comment">// Set value to high</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    </div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a>);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div><div class="ttc" id="zephyr_8h_html_afe4816e53e5d7a1264d7b0eec60b7eb9"><div class="ttname"><a href="zephyr_8h.html#afe4816e53e5d7a1264d7b0eec60b7eb9">nextMsgTime</a></div><div class="ttdeci">struct timespec nextMsgTime</div><div class="ttdoc">Earliest time that is OK to send the next message (no more than once/sec) </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00106">zephyr.h:106</a></div></div>
<div class="ttc" id="zephyr_8c_html_a8ed0e63e6cf78544f92b023037e3e7b8"><div class="ttname"><a href="zephyr_8c.html#a8ed0e63e6cf78544f92b023037e3e7b8">LoadConfigFileSettings</a></div><div class="ttdeci">int LoadConfigFileSettings(config_t *cfg, const char *path)</div><div class="ttdoc">Reads the program configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01018">zephyr.c:1018</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad4b9eb4866c26710cf777628af77626e"><div class="ttname"><a href="zephyr_8h.html#ad4b9eb4866c26710cf777628af77626e">TCnumParts</a></div><div class="ttdeci">int TCnumParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8c_html_a40185ea52d16cecaafae70740e90af29"><div class="ttname"><a href="zephyr_8c.html#a40185ea52d16cecaafae70740e90af29">Usage</a></div><div class="ttdeci">void Usage(void)</div><div class="ttdoc">Prints the usage summary showing valid command line options. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00993">zephyr.c:993</a></div></div>
<div class="ttc" id="zephyr_8h_html_ae7b49ade5fe88e53a5f0dda94ae94b23"><div class="ttname"><a href="zephyr_8h.html#ae7b49ade5fe88e53a5f0dda94ae94b23">safeAck</a></div><div class="ttdeci">int safeAck</div><div class="ttdoc">Flag that indicates the Safety message has been acknowledged. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00093">zephyr.h:93</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac380ae62365b5574461d06a4c004d681"><div class="ttname"><a href="zephyr_8h.html#ac380ae62365b5574461d06a4c004d681">safeTimeout</a></div><div class="ttdeci">int safeTimeout</div><div class="ttdoc">Time at which ROC enters Safe mode if it hasn&amp;#39;t heard from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00101">zephyr.h:101</a></div></div>
<div class="ttc" id="zephyr_8h_html_a7d97c19b1f965c9fdcefe9e9c83fe126"><div class="ttname"><a href="zephyr_8h.html#a7d97c19b1f965c9fdcefe9e9c83fe126">lastPart</a></div><div class="ttdeci">int lastPart</div><div class="ttdoc">Stores progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a416de92c0d71270e5d9eb87ba5853e39"><div class="ttname"><a href="roc2_8h.html#a416de92c0d71270e5d9eb87ba5853e39">BCSUCCESS</a></div><div class="ttdeci">#define BCSUCCESS</div><div class="ttdoc">Return code for functions that complete successfully. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00032">roc2.h:32</a></div></div>
<div class="ttc" id="zephyr_8h_html_a4388415ac8b79e24f68e40759a23651f"><div class="ttname"><a href="zephyr_8h.html#a4388415ac8b79e24f68e40759a23651f">wakeUpFlag</a></div><div class="ttdeci">int wakeUpFlag</div><div class="ttdoc">Notifies main loop to toggle wake up line. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00092">zephyr.h:92</a></div></div>
<div class="ttc" id="roc2_8h_html_a2896431d6a80cd39b3d24b40237612ee"><div class="ttname"><a href="roc2_8h.html#a2896431d6a80cd39b3d24b40237612ee">quit</a></div><div class="ttdeci">int quit</div><div class="ttdoc">Tells the main loop when to exit. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00078">roc2.h:78</a></div></div>
<div class="ttc" id="zephyr_8c_html_a093f472d65a4478a2a23fa69ea593ef0"><div class="ttname"><a href="zephyr_8c.html#a093f472d65a4478a2a23fa69ea593ef0">gps_power</a></div><div class="ttdeci">void gps_power(int state)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01940">zephyr.c:1940</a></div></div>
<div class="ttc" id="roc2_8h_html_ad76d1750a6cdeebd506bfcd6752554d2"><div class="ttname"><a href="roc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">ON</a></div><div class="ttdeci">#define ON</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00016">roc2.h:16</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37b17e868a3191ab989eeb7dc8cd393"><div class="ttname"><a href="zephyr_8h.html#aa37b17e868a3191ab989eeb7dc8cd393">waitingIM</a></div><div class="ttdeci">int waitingIM</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00099">zephyr.h:99</a></div></div>
<div class="ttc" id="zephyr_8h_html_a3b02c8218b4fda72755b780d51977c38"><div class="ttname"><a href="zephyr_8h.html#a3b02c8218b4fda72755b780d51977c38">SAFETIMEOUT</a></div><div class="ttdeci">#define SAFETIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00017">zephyr.h:17</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa33b085cbf737c4c0159e57eb661da0d"><div class="ttname"><a href="zephyr_8h.html#aa33b085cbf737c4c0159e57eb661da0d">pathCfgZephyr</a></div><div class="ttdeci">const char * pathCfgZephyr</div><div class="ttdoc">Full path to zephyr configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00075">zephyr.h:75</a></div></div>
<div class="ttc" id="zephyr_8h_html_a5b3e85b8b041c8b4a422f22faa6f87be"><div class="ttname"><a href="zephyr_8h.html#a5b3e85b8b041c8b4a422f22faa6f87be">nextImr</a></div><div class="ttdeci">time_t nextImr</div><div class="ttdoc">Timer that keeps track of when to send out IMR messages until it gets a response. ...</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00110">zephyr.h:110</a></div></div>
<div class="ttc" id="zephyr_8h_html_afbce215e681be701ae5373fd692dd9ba"><div class="ttname"><a href="zephyr_8h.html#afbce215e681be701ae5373fd692dd9ba">hwversion</a></div><div class="ttdeci">int hwversion</div><div class="ttdoc">Version number of interface board. As of 6/10/18 ROC2.1 and 2.2 have version 2, ROC2.3 has version 3. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00111">zephyr.h:111</a></div></div>
<div class="ttc" id="zephyr_8h_html_afd6a133642d784682fb4eb4c33ca2bd8"><div class="ttname"><a href="zephyr_8h.html#afd6a133642d784682fb4eb4c33ca2bd8">modeSwitch</a></div><div class="ttdeci">int modeSwitch</div><div class="ttdoc">Notifies main loop when instrument mode is changed. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00091">zephyr.h:91</a></div></div>
<div class="ttc" id="zephyr_8h_html_aac92057dcdbc7740fb0c9166a6002229"><div class="ttname"><a href="zephyr_8h.html#aac92057dcdbc7740fb0c9166a6002229">cfgZephyr</a></div><div class="ttdeci">config_t cfgZephyr</div><div class="ttdoc">Pointer to structure holding data from config file. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00077">zephyr.h:77</a></div></div>
<div class="ttc" id="zephyr_8h_html_ac292f396289364d78037cae452f1aefc"><div class="ttname"><a href="zephyr_8h.html#ac292f396289364d78037cae452f1aefc">waitingAck</a></div><div class="ttdeci">int waitingAck</div><div class="ttdoc">Indicates we&amp;#39;re waiting for acknowledgement from Zephyr. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00098">zephyr.h:98</a></div></div>
<div class="ttc" id="zephyr_8h_html_a5161d377a61befc3f8103e794d5cb582"><div class="ttname"><a href="zephyr_8h.html#a5161d377a61befc3f8103e794d5cb582">shutdown</a></div><div class="ttdeci">int shutdown</div><div class="ttdoc">Indicates whether system should shutdown after this process ends. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00107">zephyr.h:107</a></div></div>
<div class="ttc" id="zephyr_8h_html_a052dadad9560c0874f9dfeedae0ccb3b"><div class="ttname"><a href="zephyr_8h.html#a052dadad9560c0874f9dfeedae0ccb3b">LOWPOWERCHECK</a></div><div class="ttdeci">#define LOWPOWERCHECK</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00018">zephyr.h:18</a></div></div>
<div class="ttc" id="roc2_8h_html_a14ded244c47bbba850a8a4be6d16c7e3"><div class="ttname"><a href="roc2_8h.html#a14ded244c47bbba850a8a4be6d16c7e3">MODULE_NAME</a></div><div class="ttdeci">#define MODULE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00021">roc2.h:21</a></div></div>
<div class="ttc" id="zephyr_8h_html_a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135"><div class="ttname"><a href="zephyr_8h.html#a1a6b6fb557d8d37d59700faf4e4c9167ad3000f705564090d2acd1d320ccc5135">SB</a></div><div class="ttdoc">StandBy Mode. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00128">zephyr.h:128</a></div></div>
<div class="ttc" id="zephyr_8h_html_a677b57bdce5f420b65e52d6eeb0bec5a"><div class="ttname"><a href="zephyr_8h.html#a677b57bdce5f420b65e52d6eeb0bec5a">zephyr</a></div><div class="ttdeci">serial zephyr</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00124">zephyr.h:124</a></div></div>
<div class="ttc" id="roc2_8h_html_ad68a72f177ed1f87cf7cc8325069d9a0"><div class="ttname"><a href="roc2_8h.html#ad68a72f177ed1f87cf7cc8325069d9a0">ipcPipe</a></div><div class="ttdeci">const char * ipcPipe</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00069">roc2.h:69</a></div></div>
<div class="ttc" id="roc2_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="roc2_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00015">roc2.h:15</a></div></div>
<div class="ttc" id="zephyr_8h_html_a8d5fb6f3fe9be9941e57854d5c3f2568"><div class="ttname"><a href="zephyr_8h.html#a8d5fb6f3fe9be9941e57854d5c3f2568">MsgID</a></div><div class="ttdeci">int MsgID</div><div class="ttdoc">counter that increments with each sent message </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00155">zephyr.h:155</a></div></div>
<div class="ttc" id="zephyr_8h_html_aa37266c0efaae4ac2d8a5fbba8341a9e"><div class="ttname"><a href="zephyr_8h.html#aa37266c0efaae4ac2d8a5fbba8341a9e">numParts</a></div><div class="ttdeci">int numParts</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00096">zephyr.h:96</a></div></div>
<div class="ttc" id="roc2_8h_html_a2e4e582aaaf87aeeb9f5cce7b1be9794"><div class="ttname"><a href="roc2_8h.html#a2e4e582aaaf87aeeb9f5cce7b1be9794">BCCMDLINEERROR</a></div><div class="ttdeci">#define BCCMDLINEERROR</div><div class="ttdoc">Indicates error on command line. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00037">roc2.h:37</a></div></div>
<div class="ttc" id="roc2_8h_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="roc2_8h.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Print diagnostic messages to stdout. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00077">roc2.h:77</a></div></div>
<div class="ttc" id="roc2_8h_html_acc734db768f05ebce6e4e985e44f46c5"><div class="ttname"><a href="roc2_8h.html#acc734db768f05ebce6e4e985e44f46c5">BCCONFIGREADERROR</a></div><div class="ttdeci">#define BCCONFIGREADERROR</div><div class="ttdoc">Indicates error reading configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00035">roc2.h:35</a></div></div>
<div class="ttc" id="zephyr_8h_html_a57408962695c0061aac03bb3a81b9658"><div class="ttname"><a href="zephyr_8h.html#a57408962695c0061aac03bb3a81b9658">TClastPart</a></div><div class="ttdeci">int TClastPart</div><div class="ttdoc">Saves Stored progress of multi-part data file offload. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00097">zephyr.h:97</a></div></div>
<div class="ttc" id="zephyr_8h_html_af7f4cea1c772506355074b09428675b7"><div class="ttname"><a href="zephyr_8h.html#af7f4cea1c772506355074b09428675b7">discardFirstFile</a></div><div class="ttdeci">int discardFirstFile</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00105">zephyr.h:105</a></div></div>
<div class="ttc" id="zephyr_8c_html_a919ac26442368faff61c89f0f62fd58b"><div class="ttname"><a href="zephyr_8c.html#a919ac26442368faff61c89f0f62fd58b">SerialPortInit</a></div><div class="ttdeci">int SerialPortInit(serial port)</div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l01180">zephyr.c:1180</a></div></div>
<div class="ttc" id="zephyr_8h_html_ad4d4536ebc16bcd99fca3934346c8372"><div class="ttname"><a href="zephyr_8h.html#ad4d4536ebc16bcd99fca3934346c8372">poweroffgps</a></div><div class="ttdeci">int poweroffgps</div><div class="ttdoc">flags that we have sent power command to GPS </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00090">zephyr.h:90</a></div></div>
<div class="ttc" id="zephyr_8c_html_a5dbf303fd2c465b1e724a247623fdbd2"><div class="ttname"><a href="zephyr_8c.html#a5dbf303fd2c465b1e724a247623fdbd2">CmdLineHandler</a></div><div class="ttdeci">int CmdLineHandler(int argc, char *argv[])</div><div class="ttdoc">Parses command line arguments. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8c_source.html#l00903">zephyr.c:903</a></div></div>
<div class="ttc" id="roc2_8h_html_a576d1db2a3cf8ffa97ba33bbb1420592"><div class="ttname"><a href="roc2_8h.html#a576d1db2a3cf8ffa97ba33bbb1420592">pipefp</a></div><div class="ttdeci">FILE * pipefp</div><div class="ttdoc">Pointer to named pipe for communicating with Zephyr process. </div><div class="ttdef"><b>Definition:</b> <a href="roc2_8h_source.html#l00082">roc2.h:82</a></div></div>
<div class="ttc" id="zephyr_8h_html_a52ca9e601c9d0389607ec95f1c49215e"><div class="ttname"><a href="zephyr_8h.html#a52ca9e601c9d0389607ec95f1c49215e">lowPowerCheck</a></div><div class="ttdeci">int lowPowerCheck</div><div class="ttdoc">Time interval at which we check the low power state. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00102">zephyr.h:102</a></div></div>
<div class="ttc" id="zephyr_8h_html_af8bedab821ee7f36762a64ac71e914a4"><div class="ttname"><a href="zephyr_8h.html#af8bedab821ee7f36762a64ac71e914a4">lowPowerCheckWait</a></div><div class="ttdeci">int lowPowerCheckWait</div><div class="ttdoc">Flag to hold off low power check. </div><div class="ttdef"><b>Definition:</b> <a href="zephyr_8h_source.html#l00103">zephyr.h:103</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_cgraph.png" border="0" usemap="#zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_cgraph" alt=""/></div>
<map name="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_cgraph" id="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_icgraph.png" border="0" usemap="#zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_icgraph" alt=""/></div>
<map name="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_icgraph" id="zephyr_8c_a26a5cd9326852a6f3a89225c8642479b_icgraph">
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 19 2018 14:23:52 for Strateole2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
